var Fi=Object.defineProperty;var Hi=(t,e,n)=>e in t?Fi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var C=(t,e,n)=>Hi(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const qi=["white","black"],Be=["a","b","c","d","e","f","g","h"],$e=["1","2","3","4","5","6","7","8"],zi=[...$e].reverse(),At=Array.prototype.concat(...Be.map(t=>$e.map(e=>t+e))),z=t=>At[8*t[0]+t[1]],k=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],En=At.map(k);function ji(t){let e;const n=()=>(e===void 0&&(e=t()),e);return n.clear=()=>{e=void 0},n}const Ki=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},Tt=t=>t==="white"?"black":"white",Ae=(t,e)=>{const n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i},pt=(t,e)=>t.role===e.role&&t.color===e.color,Pe=t=>(e,n)=>[(n?e[0]:7-e[0])*t.width/8,(n?7-e[1]:e[1])*t.height/8],W=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},In=(t,e,n=1)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px) scale(${n})`},Mt=(t,e)=>{t.style.visibility=e?"visible":"hidden"},ve=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},Sn=t=>t.button===2,G=(t,e)=>{const n=document.createElement(t);return e&&(n.className=e),n};function Cn(t,e,n){const i=k(t);return e||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}const pe=(t,e)=>Math.abs(t-e),Ui=t=>(e,n,i,r)=>pe(e,i)<2&&(t==="white"?r===n+1||n<=1&&r===n+2&&e===i:r===n-1||n>=6&&r===n-2&&e===i),kn=(t,e,n,i)=>{const r=pe(t,n),o=pe(e,i);return r===1&&o===2||r===2&&o===1},An=(t,e,n,i)=>pe(t,n)===pe(e,i),Tn=(t,e,n,i)=>t===n||e===i,Mn=(t,e,n,i)=>An(t,e,n,i)||Tn(t,e,n,i),Wi=(t,e,n)=>(i,r,o,s)=>pe(i,o)<2&&pe(r,s)<2||n&&r===s&&r===(t==="white"?0:7)&&(i===4&&(o===2&&e.includes(0)||o===6&&e.includes(7))||e.includes(o));function Vi(t,e){const n=e==="white"?"1":"8",i=[];for(const[r,o]of t)r[1]===n&&o.color===e&&o.role==="rook"&&i.push(k(r)[0]);return i}function Pn(t,e,n){const i=t.get(e);if(!i)return[];const r=k(e),o=i.role,s=o==="pawn"?Ui(i.color):o==="knight"?kn:o==="bishop"?An:o==="rook"?Tn:o==="queen"?Mn:Wi(i.color,Vi(t,i.color),n);return En.filter(a=>(r[0]!==a[0]||r[1]!==a[1])&&s(r[0],r[1],a[0],a[1])).map(z)}function $(t,...e){t&&setTimeout(()=>t(...e),1)}function Gi(t){t.orientation=Tt(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function Qi(t,e){for(const[n,i]of e)i?t.pieces.set(n,i):t.pieces.delete(n)}function Yi(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[n,i]of t.pieces)i.role==="king"&&i.color===e&&(t.check=n)}function Zi(t,e,n,i){se(t),t.premovable.current=[e,n],$(t.premovable.events.set,e,n,i)}function oe(t){t.premovable.current&&(t.premovable.current=void 0,$(t.premovable.events.unset))}function Ji(t,e,n){oe(t),t.predroppable.current={role:e,key:n},$(t.predroppable.events.set,e,n)}function se(t){const e=t.predroppable;e.current&&(e.current=void 0,$(e.events.unset))}function Xi(t,e,n){if(!t.autoCastle)return!1;const i=t.pieces.get(e);if(!i||i.role!=="king")return!1;const r=k(e),o=k(n);if(r[1]!==0&&r[1]!==7||r[1]!==o[1])return!1;r[0]===4&&!t.pieces.has(n)&&(o[0]===6?n=z([7,o[1]]):o[0]===2&&(n=z([0,o[1]])));const s=t.pieces.get(n);return!s||s.color!==i.color||s.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(n),r[0]<o[0]?(t.pieces.set(z([6,o[1]]),i),t.pieces.set(z([5,o[1]]),s)):(t.pieces.set(z([2,o[1]]),i),t.pieces.set(z([3,o[1]]),s)),!0)}function Dn(t,e,n){const i=t.pieces.get(e),r=t.pieces.get(n);if(e===n||!i)return!1;const o=r&&r.color!==i.color?r:void 0;return n===t.selected&&j(t),$(t.events.move,e,n,o),Xi(t,e,n)||(t.pieces.set(n,i),t.pieces.delete(e)),t.lastMove=[e,n],t.check=void 0,$(t.events.change),o||!0}function Pt(t,e,n,i){if(t.pieces.has(n))if(i)t.pieces.delete(n);else return!1;return $(t.events.dropNewPiece,e,n),t.pieces.set(n,e),t.lastMove=[n],t.check=void 0,$(t.events.change),t.movable.dests=void 0,t.turnColor=Tt(t.turnColor),!0}function xn(t,e,n){const i=Dn(t,e,n);return i&&(t.movable.dests=void 0,t.turnColor=Tt(t.turnColor),t.animation.current=void 0),i}function Rn(t,e,n){if(Dt(t,e,n)){const i=xn(t,e,n);if(i){const r=t.hold.stop();j(t);const o={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:r};return i!==!0&&(o.captured=i),$(t.movable.events.after,e,n,o),!0}}else if(tr(t,e,n))return Zi(t,e,n,{ctrlKey:t.stats.ctrlKey}),j(t),!0;return j(t),!1}function Ln(t,e,n,i){const r=t.pieces.get(e);r&&(er(t,e,n)||i)?(t.pieces.delete(e),Pt(t,r,n,i),$(t.movable.events.afterNewPiece,r.role,n,{premove:!1,predrop:!1})):r&&nr(t,e,n)?Ji(t,r.role,n):(oe(t),se(t)),t.pieces.delete(e),j(t)}function gt(t,e,n){if($(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){j(t),t.hold.cancel();return}else if((t.selectable.enabled||n)&&t.selected!==e&&Rn(t,t.selected,e)){t.stats.dragged=!1;return}}(t.selectable.enabled||t.draggable.enabled)&&(On(t,e)||xt(t,e))&&(Nn(t,e),t.hold.start())}function Nn(t,e){t.selected=e,xt(t,e)?t.premovable.customDests||(t.premovable.dests=Pn(t.pieces,e,t.premovable.castle)):t.premovable.dests=void 0}function j(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function On(t,e){const n=t.pieces.get(e);return!!n&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}const Dt=(t,e,n)=>{var i,r;return e!==n&&On(t,e)&&(t.movable.free||!!(!((r=(i=t.movable.dests)===null||i===void 0?void 0:i.get(e))===null||r===void 0)&&r.includes(n)))};function er(t,e,n){const i=t.pieces.get(e);return!!i&&(e===n||!t.pieces.has(n))&&(t.movable.color==="both"||t.movable.color===i.color&&t.turnColor===i.color)}function xt(t,e){const n=t.pieces.get(e);return!!n&&t.premovable.enabled&&t.movable.color===n.color&&t.turnColor!==n.color}function tr(t,e,n){var i,r;const o=(r=(i=t.premovable.customDests)===null||i===void 0?void 0:i.get(e))!==null&&r!==void 0?r:Pn(t.pieces,e,t.premovable.castle);return e!==n&&xt(t,e)&&o.includes(n)}function nr(t,e,n){const i=t.pieces.get(e),r=t.pieces.get(n);return!!i&&(!r||r.color!==t.movable.color)&&t.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&t.movable.color===i.color&&t.turnColor!==i.color}function ir(t,e){const n=t.pieces.get(e);return!!n&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===n.color&&(t.turnColor===n.color||t.premovable.enabled))}function rr(t){const e=t.premovable.current;if(!e)return!1;const n=e[0],i=e[1];let r=!1;if(Dt(t,n,i)){const o=xn(t,n,i);if(o){const s={premove:!0};o!==!0&&(s.captured=o),$(t.movable.events.after,n,i,s),r=!0}}return oe(t),r}function or(t,e){const n=t.predroppable.current;let i=!1;if(!n)return!1;if(e(n)){const r={role:n.role,color:t.movable.color};Pt(t,r,n.key)&&($(t.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return se(t),i}function Rt(t){oe(t),se(t),j(t)}function zt(t){t.movable.color=t.movable.dests=t.animation.current=void 0,Rt(t)}function ye(t,e,n){let i=Math.floor(8*(t[0]-n.left)/n.width);e||(i=7-i);let r=7-Math.floor(8*(t[1]-n.top)/n.height);return e||(r=7-r),i>=0&&i<8&&r>=0&&r<8?z([i,r]):void 0}function sr(t,e,n,i){const r=k(t),o=En.filter(l=>Mn(r[0],r[1],l[0],l[1])||kn(r[0],r[1],l[0],l[1])),a=o.map(l=>Cn(z(l),n,i)).map(l=>Ae(e,l)),[,c]=a.reduce((l,d,u)=>l[0]<d?l:[d,u],[a[0],0]);return z(o[c])}const F=t=>t.orientation==="white",Bn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",ar={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},cr={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function $n(t){t==="start"&&(t=Bn);const e=new Map;let n=7,i=0;for(const r of t)switch(r){case" ":case"[":return e;case"/":if(--n,n<0)return e;i=0;break;case"~":{const o=e.get(z([i-1,n]));o&&(o.promoted=!0);break}default:{const o=r.charCodeAt(0);if(o<57)i+=o-48;else{const s=r.toLowerCase();e.set(z([i,n]),{role:ar[s],color:r===s?"black":"white"}),++i}}}return e}function lr(t){return zi.map(e=>Be.map(n=>{const i=t.get(n+e);if(i){let r=cr[i.role];return i.color==="white"&&(r=r.toUpperCase()),i.promoted&&(r+="~"),r}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function Fn(t,e){e.animation&&(Lt(t.animation,e.animation),(t.animation.duration||0)<70&&(t.animation.enabled=!1))}function Hn(t,e){var n,i,r;if(!((n=e.movable)===null||n===void 0)&&n.dests&&(t.movable.dests=void 0),!((i=e.drawable)===null||i===void 0)&&i.autoShapes&&(t.drawable.autoShapes=[]),Lt(t,e),e.fen&&(t.pieces=$n(e.fen),t.drawable.shapes=((r=e.drawable)===null||r===void 0?void 0:r.shapes)||[]),"check"in e&&Yi(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&Nn(t,t.selected),Fn(t,e),!t.movable.rookCastle&&t.movable.dests){const o=t.movable.color==="white"?"1":"8",s="e"+o,a=t.movable.dests.get(s),c=t.pieces.get(s);if(!a||!c||c.role!=="king")return;t.movable.dests.set(s,a.filter(l=>!(l==="a"+o&&a.includes("c"+o))&&!(l==="h"+o&&a.includes("g"+o))))}}function Lt(t,e){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(t,n)&&jt(t[n])&&jt(e[n])?Lt(t[n],e[n]):t[n]=e[n])}function jt(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}const de=(t,e)=>e.animation.enabled?hr(t,e):X(t,e);function X(t,e){const n=t(e);return e.dom.redraw(),n}const Xe=(t,e)=>({key:t,pos:k(t),piece:e}),dr=(t,e)=>e.sort((n,i)=>Ae(t.pos,n.pos)-Ae(t.pos,i.pos))[0];function ur(t,e){const n=new Map,i=[],r=new Map,o=[],s=[],a=new Map;let c,l,d;for(const[u,h]of t)a.set(u,Xe(u,h));for(const u of At)c=e.pieces.get(u),l=a.get(u),c?l?pt(c,l.piece)||(o.push(l),s.push(Xe(u,c))):s.push(Xe(u,c)):l&&o.push(l);for(const u of s)l=dr(u,o.filter(h=>pt(u.piece,h.piece))),l&&(d=[l.pos[0]-u.pos[0],l.pos[1]-u.pos[1]],n.set(u.key,d.concat(d)),i.push(l.key));for(const u of o)i.includes(u.key)||r.set(u.key,u.piece);return{anims:n,fadings:r}}function qn(t,e){const n=t.animation.current;if(n===void 0){t.dom.destroyed||t.dom.redrawNow();return}const i=1-(e-n.start)*n.frequency;if(i<=0)t.animation.current=void 0,t.dom.redrawNow();else{const r=fr(i);for(const o of n.plan.anims.values())o[2]=o[0]*r,o[3]=o[1]*r;t.dom.redrawNow(!0),requestAnimationFrame((o=performance.now())=>qn(t,o))}}function hr(t,e){const n=new Map(e.pieces),i=t(e),r=ur(n,e);if(r.anims.size||r.fadings.size){const o=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:r},o||qn(e,performance.now())}else e.dom.redraw();return i}const fr=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,pr=["green","red","blue","yellow"];function gr(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?j(t):Rt(t);const n=ve(e),i=ye(n,F(t),t.dom.bounds());i&&(t.drawable.current={orig:i,pos:n,brush:yr(e),snapToValidMove:t.drawable.defaultSnapToValidMove},zn(t))}function zn(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const n=ye(e.pos,F(t),t.dom.bounds());n||(e.snapToValidMove=!1);const i=e.snapToValidMove?sr(e.orig,e.pos,F(t),t.dom.bounds()):n;i!==e.mouseSq&&(e.mouseSq=i,e.dest=i!==e.orig?i:void 0,t.dom.redrawNow()),zn(t)}})}function mr(t,e){t.drawable.current&&(t.drawable.current.pos=ve(e))}function br(t){const e=t.drawable.current;e&&(e.mouseSq&&wr(t.drawable,e),jn(t))}function jn(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function vr(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),Kn(t.drawable))}function yr(t){var e;const n=(t.shiftKey||t.ctrlKey)&&Sn(t),i=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return pr[(n?1:0)+(i?2:0)]}function wr(t,e){const n=r=>r.orig===e.orig&&r.dest===e.dest,i=t.shapes.find(n);i&&(t.shapes=t.shapes.filter(r=>!n(r))),(!i||i.brush!==e.brush)&&t.shapes.push({orig:e.orig,dest:e.dest,brush:e.brush}),Kn(t)}function Kn(t){t.onChange&&t.onChange(t.shapes)}function _r(t,e){if(!(t.trustAllEvents||e.isTrusted)||e.buttons!==void 0&&e.buttons>1||e.touches&&e.touches.length>1)return;const n=t.dom.bounds(),i=ve(e),r=ye(i,F(t),n);if(!r)return;const o=t.pieces.get(r),s=t.selected;if(!s&&t.drawable.enabled&&(t.drawable.eraseOnClick||!o||o.color!==t.turnColor)&&vr(t),e.cancelable!==!1&&(!e.touches||t.blockTouchScroll||o||s||Er(t,i)))e.preventDefault();else if(e.touches)return;const a=!!t.premovable.current,c=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&Dt(t,t.selected,r)?de(u=>gt(u,r),t):gt(t,r);const l=t.selected===r,d=Wn(t,r);if(o&&d&&l&&ir(t,r)){t.draggable.current={orig:r,piece:o,origPos:i,pos:i,started:t.draggable.autoDistance&&t.stats.dragged,element:d,previouslySelected:s,originTarget:e.target,keyHasChanged:!1},d.cgDragging=!0,d.classList.add("dragging");const u=t.dom.elements.ghost;u&&(u.className=`ghost ${o.color} ${o.role}`,W(u,Pe(n)(k(r),F(t))),Mt(u,!0)),Nt(t)}else a&&oe(t),c&&se(t);t.dom.redraw()}function Er(t,e){const n=F(t),i=t.dom.bounds(),r=Math.pow(i.width/8,2);for(const o of t.pieces.keys()){const s=Cn(o,n,i);if(Ae(s,e)<=r)return!0}return!1}function Ir(t,e,n,i){const r="a0";t.pieces.set(r,e),t.dom.redraw();const o=ve(n);t.draggable.current={orig:r,piece:e,origPos:o,pos:o,started:!0,element:()=>Wn(t,r),originTarget:n.target,newPiece:!0,force:!!i,keyHasChanged:!1},Nt(t)}function Nt(t){requestAnimationFrame(()=>{var e;const n=t.draggable.current;if(!n)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(n.orig)&&(t.animation.current=void 0);const i=t.pieces.get(n.orig);if(!i||!pt(i,n.piece))Fe(t);else if(!n.started&&Ae(n.pos,n.origPos)>=Math.pow(t.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const o=n.element();if(!o)return;o.cgDragging=!0,o.classList.add("dragging"),n.element=o}const r=t.dom.bounds();W(n.element,[n.pos[0]-r.left-r.width/16,n.pos[1]-r.top-r.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==ye(n.pos,F(t),r))}Nt(t)})}function Sr(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=ve(e))}function Cr(t,e){const n=t.draggable.current;if(!n)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&n.originTarget!==e.target&&!n.newPiece){t.draggable.current=void 0;return}oe(t),se(t);const i=ve(e)||n.pos,r=ye(i,F(t),t.dom.bounds());r&&n.started&&n.orig!==r?n.newPiece?Ln(t,n.orig,r,n.force):(t.stats.ctrlKey=e.ctrlKey,Rn(t,n.orig,r)&&(t.stats.dragged=!0)):n.newPiece?t.pieces.delete(n.orig):t.draggable.deleteOnDropOff&&!r&&(t.pieces.delete(n.orig),$(t.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===r||!r)?j(t):t.selectable.enabled||j(t),Un(t),t.draggable.current=void 0,t.dom.redraw()}function Fe(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,j(t),Un(t),t.dom.redraw())}function Un(t){const e=t.dom.elements;e.ghost&&Mt(e.ghost,!1)}function Wn(t,e){let n=t.dom.elements.board.firstChild;for(;n;){if(n.cgKey===e&&n.tagName==="PIECE")return n;n=n.nextSibling}}function kr(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{Kt(t,2),setTimeout(()=>Kt(t,void 0),120)},120)}function Kt(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function Ar(t,e){function n(){Gi(t),e()}return{set(i){i.orientation&&i.orientation!==t.orientation&&n(),Fn(t,i),(i.fen?de:X)(r=>Hn(r,i),t)},state:t,getFen:()=>lr(t.pieces),toggleOrientation:n,setPieces(i){de(r=>Qi(r,i),t)},selectSquare(i,r){i?de(o=>gt(o,i,r),t):t.selected&&(j(t),t.dom.redraw())},move(i,r){de(o=>Dn(o,i,r),t)},newPiece(i,r){de(o=>Pt(o,i,r),t)},playPremove(){if(t.premovable.current){if(de(rr,t))return!0;t.dom.redraw()}return!1},playPredrop(i){if(t.predroppable.current){const r=or(t,i);return t.dom.redraw(),r}return!1},cancelPremove(){X(oe,t)},cancelPredrop(){X(se,t)},cancelMove(){X(i=>{Rt(i),Fe(i)},t)},stop(){X(i=>{zt(i),Fe(i)},t)},explode(i){kr(t,i)},setAutoShapes(i){X(r=>r.drawable.autoShapes=i,t)},setShapes(i){X(r=>r.drawable.shapes=i,t)},getKeyAtDomPos(i){return ye(i,F(t),t.dom.bounds())},redrawAll:e,dragNewPiece(i,r,o){Ir(t,i,r,o)},destroy(){zt(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function Tr(){return{pieces:$n(Bn),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:Ki()}}const Ut={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Mr(){const t=P("defs"),e=N(P("filter"),{id:"cg-filter-blur"});return e.appendChild(N(P("feGaussianBlur"),{stdDeviation:"0.019"})),t.appendChild(e),t}function Pr(t,e,n){var i;const r=t.drawable,o=r.current,s=o&&o.mouseSq?o:void 0,a=new Map,c=t.dom.bounds(),l=r.autoShapes.filter(m=>!m.piece);for(const m of r.shapes.concat(l).concat(s?[s]:[])){if(!m.dest)continue;const f=(i=a.get(m.dest))!==null&&i!==void 0?i:new Set,g=ze(qe(k(m.orig),t.orientation),c),_=ze(qe(k(m.dest),t.orientation),c);f.add(bt(g,_)),a.set(m.dest,f)}const d=r.shapes.concat(l).map(m=>({shape:m,current:!1,hash:Wt(m,mt(m.dest,a),!1,c)}));s&&d.push({shape:s,current:!0,hash:Wt(s,mt(s.dest,a),!0,c)});const u=d.map(m=>m.hash).join(";");if(u===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=u;const h=e.querySelector("defs");Dr(r,d,h),xr(d,e.querySelector("g"),n.querySelector("g"),m=>Nr(t,m,r.brushes,a,c))}function Dr(t,e,n){var i;const r=new Map;let o;for(const c of e.filter(l=>l.shape.dest&&l.shape.brush))o=Vn(t.brushes[c.shape.brush],c.shape.modifiers),!((i=c.shape.modifiers)===null||i===void 0)&&i.hilite&&r.set(He(o).key,He(o)),r.set(o.key,o);const s=new Set;let a=n.firstElementChild;for(;a;)s.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[c,l]of r.entries())s.has(c)||n.appendChild($r(l))}function xr(t,e,n,i){const r=new Map;for(const o of t)r.set(o.hash,!1);for(const o of[e,n]){const s=[];let a=o.firstElementChild,c;for(;a;)c=a.getAttribute("cgHash"),r.has(c)?r.set(c,!0):s.push(a),a=a.nextElementSibling;for(const l of s)o.removeChild(l)}for(const o of t.filter(s=>!r.get(s.hash)))for(const s of i(o))s.isCustom?n.appendChild(s.el):e.appendChild(s.el)}function Wt({orig:t,dest:e,brush:n,piece:i,modifiers:r,customSvg:o,label:s},a,c,l){var d,u;return[l.width,l.height,c,t,e,n,a&&"-",i&&Rr(i),r&&Lr(r),o&&`custom-${Vt(o.html)},${(u=(d=o.center)===null||d===void 0?void 0:d[0])!==null&&u!==void 0?u:"o"}`,s&&`label-${Vt(s.text)}`].filter(h=>h).join(",")}function Rr(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function Lr(t){return[t.lineWidth,t.hilite&&"*"].filter(e=>e).join(",")}function Vt(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n)>>>0;return e.toString()}function Nr(t,{shape:e,current:n,hash:i},r,o,s){var a,c;const l=ze(qe(k(e.orig),t.orientation),s),d=e.dest?ze(qe(k(e.dest),t.orientation),s):l,u=e.brush&&Vn(r[e.brush],e.modifiers),h=o.get(e.dest),m=[];if(u){const f=N(P("g"),{cgHash:i});m.push({el:f}),l[0]!==d[0]||l[1]!==d[1]?f.appendChild(Br(e,u,l,d,n,mt(e.dest,o))):f.appendChild(Or(r[e.brush],l,n,s))}if(e.label){const f=e.label;(a=f.fill)!==null&&a!==void 0||(f.fill=e.brush&&r[e.brush].color);const g=e.brush?void 0:"tr";m.push({el:Fr(f,i,l,d,h,g),isCustom:!0})}if(e.customSvg){const f=(c=e.customSvg.center)!==null&&c!==void 0?c:"orig",[g,_]=f==="label"?Qn(l,d,h).map(A=>A-.5):f==="dest"?d:l,E=N(P("g"),{transform:`translate(${g},${_})`,cgHash:i});E.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${e.customSvg.html}</svg>`,m.push({el:E,isCustom:!0})}return m}function Or(t,e,n,i){const r=Hr(),o=(i.width+i.height)/(4*Math.max(i.width,i.height));return N(P("circle"),{stroke:t.color,"stroke-width":r[n?0:1],fill:"none",opacity:Gn(t,n),cx:e[0],cy:e[1],r:o-r[1]/2})}function He(t){return["#ffffff","#fff","white"].includes(t.color)?Ut.hilitePrimary:Ut.hiliteWhite}function Br(t,e,n,i,r,o){var s;function a(d){var u;const h=zr(o&&!r),m=i[0]-n[0],f=i[1]-n[1],g=Math.atan2(f,m),_=Math.cos(g)*h,E=Math.sin(g)*h;return N(P("line"),{stroke:d?He(e).color:e.color,"stroke-width":qr(e,r)+(d?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${d?He(e).key:e.key})`,opacity:!((u=t.modifiers)===null||u===void 0)&&u.hilite?1:Gn(e,r),x1:n[0],y1:n[1],x2:i[0]-_,y2:i[1]-E})}if(!(!((s=t.modifiers)===null||s===void 0)&&s.hilite))return a(!1);const c=P("g"),l=N(P("g"),{filter:"url(#cg-filter-blur)"});return l.appendChild(jr(n,i)),l.appendChild(a(!0)),c.appendChild(l),c.appendChild(a(!1)),c}function $r(t){const e=N(P("marker"),{id:"arrowhead-"+t.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:t.key.startsWith("hilite")?1.86:2.05,refY:2});return e.appendChild(N(P("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function Fr(t,e,n,i,r,o){var s;const c=.4*.75**t.text.length,l=Qn(n,i,r),d=o==="tr"?.4:0,u=N(P("g"),{transform:`translate(${l[0]+d},${l[1]-d})`,cgHash:e});u.appendChild(N(P("circle"),{r:.4/2,"fill-opacity":o?1:.8,"stroke-opacity":o?1:.7,"stroke-width":.03,fill:(s=t.fill)!==null&&s!==void 0?s:"#666",stroke:"white"}));const h=N(P("text"),{"font-size":c,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**t.text.length});return h.innerHTML=t.text,u.appendChild(h),u}function qe(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function mt(t,e){return(t&&e.has(t)&&e.get(t).size>1)===!0}function P(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function N(t,e){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.setAttribute(n,e[n]);return t}function Vn(t,e){return e?{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(n=>n).join("")}:t}function Hr(){return[3/64,4/64]}function qr(t,e){return(t.lineWidth||10)*(e?.85:1)/64}function Gn(t,e){return(t.opacity||1)*(e?.9:1)}function zr(t){return(t?20:10)/64}function ze(t,e){const n=Math.min(1,e.width/e.height),i=Math.min(1,e.height/e.width);return[(t[0]-3.5)*n,(3.5-t[1])*i]}function jr(t,e){const n={from:[Math.floor(Math.min(t[0],e[0])),Math.floor(Math.min(t[1],e[1]))],to:[Math.ceil(Math.max(t[0],e[0])),Math.ceil(Math.max(t[1],e[1]))]};return N(P("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function bt(t,e,n=!0){const i=Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI;return n?(Math.round(i*8/Math.PI)+16)%16:i}function Kr(t,e){return Math.sqrt([t[0]-e[0],t[1]-e[1]].reduce((n,i)=>n+i*i,0))}function Qn(t,e,n){let i=Kr(t,e);const r=bt(t,e,!1);if(n&&(i-=33/64,n.size>1)){i-=10/64;const o=bt(t,e);(n.has((o+1)%16)||n.has((o+15)%16))&&o&1&&(i-=.4)}return[t[0]-Math.cos(r)*i,t[1]-Math.sin(r)*i].map(o=>o+.5)}function Ur(t,e){t.innerHTML="",t.classList.add("cg-wrap");for(const c of qi)t.classList.toggle("orientation-"+c,e.orientation===c);t.classList.toggle("manipulable",!e.viewOnly);const n=G("cg-container");t.appendChild(n);const i=G("cg-board");n.appendChild(i);let r,o,s;if(e.drawable.visible&&(r=N(P("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(Mr()),r.appendChild(P("g")),o=N(P("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(P("g")),s=G("cg-auto-pieces"),n.appendChild(r),n.appendChild(o),n.appendChild(s)),e.coordinates){const c=e.orientation==="black"?" black":"",l=e.ranksPosition==="left"?" left":"";if(e.coordinatesOnSquares){const d=e.orientation==="white"?u=>u+1:u=>8-u;Be.forEach((u,h)=>n.appendChild(et($e.map(m=>u+m),"squares rank"+d(h)+c+l)))}else n.appendChild(et($e,"ranks"+c+l)),n.appendChild(et(Be,"files"+c))}let a;return e.draggable.enabled&&e.draggable.showGhost&&(a=G("piece","ghost"),Mt(a,!1),n.appendChild(a)),{board:i,container:n,wrap:t,ghost:a,svg:r,customSvg:o,autoPieces:s}}function et(t,e){const n=G("coords",e);let i;for(const r of t)i=G("coord"),i.textContent=r,n.appendChild(i);return n}function Wr(t,e){if(!t.dropmode.active)return;oe(t),se(t);const n=t.dropmode.piece;if(n){t.pieces.set("a0",n);const i=ve(e),r=i&&ye(i,F(t),t.dom.bounds());r&&Ln(t,"a0",r)}t.dom.redraw()}function Vr(t,e){const n=t.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(e).observe(t.dom.elements.wrap),(t.disableContextMenu||t.drawable.enabled)&&n.addEventListener("contextmenu",r=>r.preventDefault()),t.viewOnly)return;const i=Qr(t);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1})}function Gr(t,e){const n=[];if("ResizeObserver"in window||n.push(_e(document.body,"chessground.resize",e)),!t.viewOnly){const i=Gt(t,Sr,mr),r=Gt(t,Cr,br);for(const s of["touchmove","mousemove"])n.push(_e(document,s,i));for(const s of["touchend","mouseup"])n.push(_e(document,s,r));const o=()=>t.dom.bounds.clear();n.push(_e(document,"scroll",o,{capture:!0,passive:!0})),n.push(_e(window,"resize",o,{passive:!0}))}return()=>n.forEach(i=>i())}function _e(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}const Qr=t=>e=>{t.draggable.current?Fe(t):t.drawable.current?jn(t):e.shiftKey||Sn(e)?t.drawable.enabled&&gr(t,e):t.viewOnly||(t.dropmode.active?Wr(t,e):_r(t,e))},Gt=(t,e,n)=>i=>{t.drawable.current?t.drawable.enabled&&n(t,i):t.viewOnly||e(t,i)};function Yr(t){const e=F(t),n=Pe(t.dom.bounds()),i=t.dom.elements.board,r=t.pieces,o=t.animation.current,s=o?o.plan.anims:new Map,a=o?o.plan.fadings:new Map,c=t.draggable.current,l=Jr(t),d=new Set,u=new Set,h=new Map,m=new Map;let f,g,_,E,A,y,x,T,ae,ce;for(g=i.firstChild;g;){if(f=g.cgKey,Yn(g))if(_=r.get(f),A=s.get(f),y=a.get(f),E=g.cgPiece,g.cgDragging&&(!c||c.orig!==f)&&(g.classList.remove("dragging"),W(g,n(k(f),e)),g.cgDragging=!1),!y&&g.cgFading&&(g.cgFading=!1,g.classList.remove("fading")),_){if(A&&g.cgAnimating&&E===Ee(_)){const I=k(f);I[0]+=A[2],I[1]+=A[3],g.classList.add("anim"),W(g,n(I,e))}else g.cgAnimating&&(g.cgAnimating=!1,g.classList.remove("anim"),W(g,n(k(f),e)),t.addPieceZIndex&&(g.style.zIndex=tt(k(f),e)));E===Ee(_)&&(!y||!g.cgFading)?d.add(f):y&&E===Ee(y)?(g.classList.add("fading"),g.cgFading=!0):nt(h,E,g)}else nt(h,E,g);else if(Zn(g)){const I=g.className;l.get(f)===I?u.add(f):nt(m,I,g)}g=g.nextSibling}for(const[I,Y]of l)if(!u.has(I)){ae=m.get(Y),ce=ae&&ae.pop();const K=n(k(I),e);if(ce)ce.cgKey=I,W(ce,K);else{const U=G("square",Y);U.cgKey=I,W(U,K),i.insertBefore(U,i.firstChild)}}for(const[I,Y]of r)if(A=s.get(I),!d.has(I))if(x=h.get(Ee(Y)),T=x&&x.pop(),T){T.cgKey=I,T.cgFading&&(T.classList.remove("fading"),T.cgFading=!1);const K=k(I);t.addPieceZIndex&&(T.style.zIndex=tt(K,e)),A&&(T.cgAnimating=!0,T.classList.add("anim"),K[0]+=A[2],K[1]+=A[3]),W(T,n(K,e))}else{const K=Ee(Y),U=G("piece",K),xe=k(I);U.cgPiece=K,U.cgKey=I,A&&(U.cgAnimating=!0,xe[0]+=A[2],xe[1]+=A[3]),W(U,n(xe,e)),t.addPieceZIndex&&(U.style.zIndex=tt(xe,e)),i.appendChild(U)}for(const I of h.values())Yt(t,I);for(const I of m.values())Yt(t,I)}function Zr(t){const e=F(t),n=Pe(t.dom.bounds());let i=t.dom.elements.board.firstChild;for(;i;)(Yn(i)&&!i.cgAnimating||Zn(i))&&W(i,n(k(i.cgKey),e)),i=i.nextSibling}function Qt(t){var e,n;const i=t.dom.elements.wrap.getBoundingClientRect(),r=t.dom.elements.container,o=i.height/i.width,s=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=s*o;r.style.width=s+"px",r.style.height=a+"px",t.dom.bounds.clear(),(e=t.addDimensionsCssVarsTo)===null||e===void 0||e.style.setProperty("---cg-width",s+"px"),(n=t.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("---cg-height",a+"px")}const Yn=t=>t.tagName==="PIECE",Zn=t=>t.tagName==="SQUARE";function Yt(t,e){for(const n of e)t.dom.elements.board.removeChild(n)}function tt(t,e){const i=t[1];return`${e?10-i:3+i}`}const Ee=t=>`${t.color} ${t.role}`;function Jr(t){var e,n,i;const r=new Map;if(t.lastMove&&t.highlight.lastMove)for(const a of t.lastMove)V(r,a,"last-move");if(t.check&&t.highlight.check&&V(r,t.check,"check"),t.selected&&(V(r,t.selected,"selected"),t.movable.showDests)){const a=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(a)for(const l of a)V(r,l,"move-dest"+(t.pieces.has(l)?" oc":""));const c=(i=(n=t.premovable.customDests)===null||n===void 0?void 0:n.get(t.selected))!==null&&i!==void 0?i:t.premovable.dests;if(c)for(const l of c)V(r,l,"premove-dest"+(t.pieces.has(l)?" oc":""))}const o=t.premovable.current;if(o)for(const a of o)V(r,a,"current-premove");else t.predroppable.current&&V(r,t.predroppable.current.key,"current-premove");const s=t.exploding;if(s)for(const a of s.keys)V(r,a,"exploding"+s.stage);return t.highlight.custom&&t.highlight.custom.forEach((a,c)=>{V(r,c,a)}),r}function V(t,e,n){const i=t.get(e);i?t.set(e,`${i} ${n}`):t.set(e,n)}function nt(t,e,n){const i=t.get(e);i?i.push(n):t.set(e,[n])}function Xr(t,e,n){const i=new Map,r=[];for(const a of t)i.set(a.hash,!1);let o=e.firstElementChild,s;for(;o;)s=o.getAttribute("cgHash"),i.has(s)?i.set(s,!0):r.push(o),o=o.nextElementSibling;for(const a of r)e.removeChild(a);for(const a of t)i.get(a.hash)||e.appendChild(n(a))}function eo(t,e){const i=t.drawable.autoShapes.filter(r=>r.piece).map(r=>({shape:r,hash:io(r),current:!1}));Xr(i,e,r=>no(t,r,t.dom.bounds()))}function to(t){var e;const n=F(t),i=Pe(t.dom.bounds());let r=(e=t.dom.elements.autoPieces)===null||e===void 0?void 0:e.firstChild;for(;r;)In(r,i(k(r.cgKey),n),r.cgScale),r=r.nextSibling}function no(t,{shape:e,hash:n},i){var r,o,s;const a=e.orig,c=(r=e.piece)===null||r===void 0?void 0:r.role,l=(o=e.piece)===null||o===void 0?void 0:o.color,d=(s=e.piece)===null||s===void 0?void 0:s.scale,u=G("piece",`${c} ${l}`);return u.setAttribute("cgHash",n),u.cgKey=a,u.cgScale=d,In(u,Pe(i)(k(a),F(t)),d),u}const io=t=>{var e,n,i;return[t.orig,(e=t.piece)===null||e===void 0?void 0:e.role,(n=t.piece)===null||n===void 0?void 0:n.color,(i=t.piece)===null||i===void 0?void 0:i.scale].join(",")};function ro(t,e){const n=Tr();Hn(n,e||{});function i(){const r="dom"in n?n.dom.unbind:void 0,o=Ur(t,n),s=ji(()=>o.board.getBoundingClientRect()),a=d=>{Yr(l),o.autoPieces&&eo(l,o.autoPieces),!d&&o.svg&&Pr(l,o.svg,o.customSvg)},c=()=>{Qt(l),Zr(l),o.autoPieces&&to(l)},l=n;return l.dom={elements:o,bounds:s,redraw:oo(a),redrawNow:a,unbind:r},l.drawable.prevSvgHash="",Qt(l),a(!1),Vr(l,c),r||(l.dom.unbind=Gr(l,c)),l.events.insert&&l.events.insert(o),l}return Ar(i(),i)}function oo(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const R="w",q="b",D="p",vt="n",Ne="b",Se="r",ee="q",M="k",it="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Re{constructor(e,n){C(this,"color");C(this,"from");C(this,"to");C(this,"piece");C(this,"captured");C(this,"promotion");C(this,"flags");C(this,"san");C(this,"lan");C(this,"before");C(this,"after");const{color:i,piece:r,from:o,to:s,flags:a,captured:c,promotion:l}=n,d=L(o),u=L(s);this.color=i,this.piece=r,this.from=d,this.to=u,this.san=e._moveToSan(n,e._moves({legal:!0})),this.lan=d+u,this.before=e.fen(),e._makeMove(n),this.after=e.fen(),e._undoMove(),this.flags="";for(const h in w)w[h]&a&&(this.flags+=le[h]);c&&(this.captured=c),l&&(this.promotion=l,this.lan+=l)}isCapture(){return this.flags.indexOf(le.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(le.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(le.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(le.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(le.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(le.BIG_PAWN)>-1}}const O=-1,le={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},w={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},v={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},rt={b:[16,32,17,15],w:[-16,-32,-17,-15]},Zt={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},so=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],ao=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],co={p:1,n:2,b:4,r:8,q:16,k:32},lo="pnbrqkPNBRQK",Jt=[vt,Ne,Se,ee],uo=7,ho=6,fo=1,po=0,Le={[M]:w.KSIDE_CASTLE,[ee]:w.QSIDE_CASTLE},Z={w:[{square:v.a1,flag:w.QSIDE_CASTLE},{square:v.h1,flag:w.KSIDE_CASTLE}],b:[{square:v.a8,flag:w.QSIDE_CASTLE},{square:v.h8,flag:w.KSIDE_CASTLE}]},go={b:fo,w:ho},mo=["1-0","0-1","1/2-1/2","*"];function fe(t){return t>>4}function Te(t){return t&15}function Jn(t){return"0123456789".indexOf(t)!==-1}function L(t){const e=Te(t),n=fe(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function Ie(t){return t===R?q:R}function bo(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(e[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=e[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let s=0;s<r.length;s++){let a=0,c=!1;for(let l=0;l<r[s].length;l++)if(Jn(r[s][l])){if(c)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(r[s][l],10),c=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[s][l]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,c=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const o=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:s,regex:a}of o){if(!a.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${s} king`};if((e[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${s} kings`}}return Array.from(r[0]+r[7]).some(s=>s.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function vo(t,e){const n=t.from,i=t.to,r=t.piece;let o=0,s=0,a=0;for(let c=0,l=e.length;c<l;c++){const d=e[c].from,u=e[c].to,h=e[c].piece;r===h&&n!==d&&i===u&&(o++,fe(n)===fe(d)&&s++,Te(n)===Te(d)&&a++)}return o>0?s>0&&a>0?L(n):a>0?L(n).charAt(1):L(n).charAt(0):""}function J(t,e,n,i,r,o=void 0,s=w.NORMAL){const a=fe(i);if(r===D&&(a===uo||a===po))for(let c=0;c<Jt.length;c++){const l=Jt[c];t.push({color:e,from:n,to:i,piece:r,captured:o,promotion:l,flags:s|w.PROMOTION})}else t.push({color:e,from:n,to:i,piece:r,captured:o,flags:s})}function Xt(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:D:(e=e.toLowerCase(),e==="o"?M:e)}function ot(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function st(t){return t.split(" ").slice(0,4).join(" ")}class Ce{constructor(e=it,{skipValidation:n=!1}={}){C(this,"_board",new Array(128));C(this,"_turn",R);C(this,"_header",{});C(this,"_kings",{w:O,b:O});C(this,"_epSquare",-1);C(this,"_halfMoves",0);C(this,"_moveNumber",0);C(this,"_history",[]);C(this,"_comments",{});C(this,"_castling",{w:0,b:0});C(this,"_positionCount",{});this.load(e,{skipValidation:n})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:O,b:O},this._turn=R,this._castling={w:0,b:0},this._epSquare=O,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}load(e,{skipValidation:n=!1,preserveHeaders:i=!1}={}){let r=e.split(/\s+/);if(r.length>=2&&r.length<6){const a=["-","-","0","1"];e=r.concat(a.slice(-(6-r.length))).join(" ")}if(r=e.split(/\s+/),!n){const{ok:a,error:c}=bo(e);if(!a)throw new Error(c)}const o=r[0];let s=0;this.clear({preserveHeaders:i});for(let a=0;a<o.length;a++){const c=o.charAt(a);if(c==="/")s+=8;else if(Jn(c))s+=parseInt(c,10);else{const l=c<"a"?R:q;this._put({type:c.toLowerCase(),color:l},L(s)),s++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=w.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=w.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=w.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=w.QSIDE_CASTLE),this._epSquare=r[3]==="-"?O:v[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){var o,s;let e=0,n="";for(let a=v.a8;a<=v.h1;a++){if(this._board[a]){e>0&&(n+=e,e=0);const{color:c,type:l}=this._board[a];n+=c===R?l.toUpperCase():l.toLowerCase()}else e++;a+1&136&&(e>0&&(n+=e),a!==v.h1&&(n+="/"),e=0,a+=8)}let i="";this._castling[R]&w.KSIDE_CASTLE&&(i+="K"),this._castling[R]&w.QSIDE_CASTLE&&(i+="Q"),this._castling[q]&w.KSIDE_CASTLE&&(i+="k"),this._castling[q]&w.QSIDE_CASTLE&&(i+="q"),i=i||"-";let r="-";if(this._epSquare!==O){const a=this._epSquare+(this._turn===R?16:-16),c=[a+1,a-1];for(const l of c){if(l&136)continue;const d=this._turn;if(((o=this._board[l])==null?void 0:o.color)===d&&((s=this._board[l])==null?void 0:s.type)===D){this._makeMove({color:d,from:l,to:this._epSquare,piece:D,captured:D,flags:w.EP_CAPTURE});const u=!this._isKingAttacked(d);if(this._undoMove(),u){r=L(this._epSquare);break}}}}return[n,this._turn,i,r,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==it?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(it)}get(e){return this._board[v[e]]}put({type:e,color:n},i){return this._put({type:e,color:n},i)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:e,color:n},i){if(lo.indexOf(e.toLowerCase())===-1||!(i in v))return!1;const r=v[i];if(e==M&&!(this._kings[n]==O||this._kings[n]==r))return!1;const o=this._board[r];return o&&o.type===M&&(this._kings[o.color]=O),this._board[r]={type:e,color:n},e===M&&(this._kings[n]=r),!0}remove(e){const n=this.get(e);return delete this._board[v[e]],n&&n.type===M&&(this._kings[n.color]=O),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var i,r,o,s,a,c,l,d,u,h,m,f;const e=((i=this._board[v.e1])==null?void 0:i.type)===M&&((r=this._board[v.e1])==null?void 0:r.color)===R,n=((o=this._board[v.e8])==null?void 0:o.type)===M&&((s=this._board[v.e8])==null?void 0:s.color)===q;(!e||((a=this._board[v.a1])==null?void 0:a.type)!==Se||((c=this._board[v.a1])==null?void 0:c.color)!==R)&&(this._castling.w&=-65),(!e||((l=this._board[v.h1])==null?void 0:l.type)!==Se||((d=this._board[v.h1])==null?void 0:d.color)!==R)&&(this._castling.w&=-33),(!n||((u=this._board[v.a8])==null?void 0:u.type)!==Se||((h=this._board[v.a8])==null?void 0:h.color)!==q)&&(this._castling.b&=-65),(!n||((m=this._board[v.h8])==null?void 0:m.type)!==Se||((f=this._board[v.h8])==null?void 0:f.color)!==q)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var o,s;if(this._epSquare===O)return;const e=this._epSquare+(this._turn===R?-16:16),n=this._epSquare+(this._turn===R?16:-16),i=[n+1,n-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((o=this._board[n])==null?void 0:o.color)!==Ie(this._turn)||((s=this._board[n])==null?void 0:s.type)!==D){this._epSquare=O;return}const r=a=>{var c,l;return!(a&136)&&((c=this._board[a])==null?void 0:c.color)===this._turn&&((l=this._board[a])==null?void 0:l.type)===D};i.some(r)||(this._epSquare=O)}_attacked(e,n,i){const r=[];for(let o=v.a8;o<=v.h1;o++){if(o&136){o+=7;continue}if(this._board[o]===void 0||this._board[o].color!==e)continue;const s=this._board[o],a=o-n;if(a===0)continue;const c=a+119;if(so[c]&co[s.type]){if(s.type===D){if(a>0&&s.color===R||a<=0&&s.color===q)if(i)r.push(L(o));else return!0;continue}if(s.type==="n"||s.type==="k")if(i){r.push(L(o));continue}else return!0;const l=ao[c];let d=o+l,u=!1;for(;d!==n;){if(this._board[d]!=null){u=!0;break}d+=l}if(!u)if(i){r.push(L(o));continue}else return!0}}return i?r:!1}attackers(e,n){return n?this._attacked(n,v[e],!0):this._attacked(this._turn,v[e],!0)}_isKingAttacked(e){const n=this._kings[e];return n===-1?!1:this._attacked(Ie(e),n)}isAttacked(e,n){return this._attacked(n,v[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let i=0,r=0;for(let o=v.a8;o<=v.h1;o++){if(r=(r+1)%2,o&136){o+=7;continue}const s=this._board[o];s&&(e[s.type]=s.type in e?e[s.type]+1:1,s.type===Ne&&n.push(r),i++)}if(i===2)return!0;if(i===3&&(e[Ne]===1||e[vt]===1))return!0;if(i===e[Ne]+2){let o=0;const s=n.length;for(let a=0;a<s;a++)o+=n[a];if(o===0||o===s)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:n=void 0,piece:i=void 0}={}){const r=this._moves({square:n,piece:i});return e?r.map(o=>new Re(this,o)):r.map(o=>this._moveToSan(o,r))}_moves({legal:e=!0,piece:n=void 0,square:i=void 0}={}){var m;const r=i?i.toLowerCase():void 0,o=n==null?void 0:n.toLowerCase(),s=[],a=this._turn,c=Ie(a);let l=v.a8,d=v.h1,u=!1;if(r)if(r in v)l=d=v[r],u=!0;else return[];for(let f=l;f<=d;f++){if(f&136){f+=7;continue}if(!this._board[f]||this._board[f].color===c)continue;const{type:g}=this._board[f];let _;if(g===D){if(o&&o!==g)continue;_=f+rt[a][0],this._board[_]||(J(s,a,f,_,D),_=f+rt[a][1],go[a]===fe(f)&&!this._board[_]&&J(s,a,f,_,D,void 0,w.BIG_PAWN));for(let E=2;E<4;E++)_=f+rt[a][E],!(_&136)&&(((m=this._board[_])==null?void 0:m.color)===c?J(s,a,f,_,D,this._board[_].type,w.CAPTURE):_===this._epSquare&&J(s,a,f,_,D,D,w.EP_CAPTURE))}else{if(o&&o!==g)continue;for(let E=0,A=Zt[g].length;E<A;E++){const y=Zt[g][E];for(_=f;_+=y,!(_&136);){if(!this._board[_])J(s,a,f,_,g);else{if(this._board[_].color===a)break;J(s,a,f,_,g,this._board[_].type,w.CAPTURE);break}if(g===vt||g===M)break}}}}if((o===void 0||o===M)&&(!u||d===this._kings[a])){if(this._castling[a]&w.KSIDE_CASTLE){const f=this._kings[a],g=f+2;!this._board[f+1]&&!this._board[g]&&!this._attacked(c,this._kings[a])&&!this._attacked(c,f+1)&&!this._attacked(c,g)&&J(s,a,this._kings[a],g,M,void 0,w.KSIDE_CASTLE)}if(this._castling[a]&w.QSIDE_CASTLE){const f=this._kings[a],g=f-2;!this._board[f-1]&&!this._board[f-2]&&!this._board[f-3]&&!this._attacked(c,this._kings[a])&&!this._attacked(c,f-1)&&!this._attacked(c,g)&&J(s,a,this._kings[a],g,M,void 0,w.QSIDE_CASTLE)}}if(!e||this._kings[a]===-1)return s;const h=[];for(let f=0,g=s.length;f<g;f++)this._makeMove(s[f]),this._isKingAttacked(a)||h.push(s[f]),this._undoMove();return h}move(e,{strict:n=!1}={}){let i=null;if(typeof e=="string")i=this._moveFromSan(e,n);else if(typeof e=="object"){const o=this._moves();for(let s=0,a=o.length;s<a;s++)if(e.from===L(o[s].from)&&e.to===L(o[s].to)&&(!("promotion"in o[s])||e.promotion===o[s].promotion)){i=o[s];break}}if(!i)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const r=new Re(this,i);return this._makeMove(i),this._incPositionCount(r.after),r}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const n=this._turn,i=Ie(n);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&w.EP_CAPTURE&&(this._turn===q?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:n}),this._board[e.to].type===M){if(this._kings[n]=e.to,e.flags&w.KSIDE_CASTLE){const r=e.to-1,o=e.to+1;this._board[r]=this._board[o],delete this._board[o]}else if(e.flags&w.QSIDE_CASTLE){const r=e.to+1,o=e.to-2;this._board[r]=this._board[o],delete this._board[o]}this._castling[n]=0}if(this._castling[n]){for(let r=0,o=Z[n].length;r<o;r++)if(e.from===Z[n][r].square&&this._castling[n]&Z[n][r].flag){this._castling[n]^=Z[n][r].flag;break}}if(this._castling[i]){for(let r=0,o=Z[i].length;r<o;r++)if(e.to===Z[i][r].square&&this._castling[i]&Z[i][r].flag){this._castling[i]^=Z[i][r].flag;break}}e.flags&w.BIG_PAWN?n===q?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=O,e.piece===D?this._halfMoves=0:e.flags&(w.CAPTURE|w.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===q&&this._moveNumber++,this._turn=i}undo(){const e=this._undoMove();if(e){const n=new Re(this,e);return this._decPositionCount(n.after),n}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const n=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const i=this._turn,r=Ie(i);if(this._board[n.from]=this._board[n.to],this._board[n.from].type=n.piece,delete this._board[n.to],n.captured)if(n.flags&w.EP_CAPTURE){let o;i===q?o=n.to-16:o=n.to+16,this._board[o]={type:D,color:r}}else this._board[n.to]={type:n.captured,color:r};if(n.flags&(w.KSIDE_CASTLE|w.QSIDE_CASTLE)){let o,s;n.flags&w.KSIDE_CASTLE?(o=n.to+1,s=n.to-1):(o=n.to-2,s=n.to+1),this._board[o]=this._board[s],delete this._board[s]}return n}pgn({newline:e=`
`,maxWidth:n=0}={}){const i=[];let r=!1;for(const h in this._header)i.push("["+h+' "'+this._header[h]+'"]'+e),r=!0;r&&this._history.length&&i.push(e);const o=h=>{const m=this._comments[this.fen()];if(typeof m<"u"){const f=h.length>0?" ":"";h=`${h}${f}{${m}}`}return h},s=[];for(;this._history.length>0;)s.push(this._undoMove());const a=[];let c="";for(s.length===0&&a.push(o(""));s.length>0;){c=o(c);const h=s.pop();if(!h)break;if(!this._history.length&&h.color==="b"){const m=`${this._moveNumber}. ...`;c=c?`${c} ${m}`:m}else h.color==="w"&&(c.length&&a.push(c),c=this._moveNumber+".");c=c+" "+this._moveToSan(h,this._moves({legal:!0})),this._makeMove(h)}if(c.length&&a.push(o(c)),typeof this._header.Result<"u"&&a.push(this._header.Result),n===0)return i.join("")+a.join(" ");const l=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},d=function(h,m){for(const f of m.split(" "))if(f){if(h+f.length>n){for(;l();)h--;i.push(e),h=0}i.push(f),h+=f.length,i.push(" "),h++}return l()&&h--,h};let u=0;for(let h=0;h<a.length;h++){if(u+a[h].length>n&&a[h].includes("{")){u=d(u,a[h]);continue}u+a[h].length>n&&h!==0?(i[i.length-1]===" "&&i.pop(),i.push(e),u=0):h!==0&&(i.push(" "),u++),i.push(a[h]),u+=a[h].length}return i.join("")}header(...e){for(let n=0;n<e.length;n+=2)typeof e[n]=="string"&&typeof e[n+1]=="string"&&(this._header[e[n]]=e[n+1]);return this._header}setHeader(e,n){return this._header[e]=n,this._header}removeHeader(e){return e in this._header?(delete this._header[e],!0):!1}getHeaders(){return this._header}loadPgn(e,{strict:n=!1,newlineChar:i=`\r?
`}={}){function r(y){return y.replace(/\\/g,"\\")}function o(y){const x={},T=y.split(new RegExp(r(i)));let ae="",ce="";for(let I=0;I<T.length;I++){const Y=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;ae=T[I].replace(Y,"$1"),ce=T[I].replace(Y,"$2"),ae.trim().length>0&&(x[ae]=ce)}return x}e=e.trim();const a=new RegExp("^(\\[((?:"+r(i)+")|.)*\\])((?:\\s*"+r(i)+"){2}|(?:\\s*"+r(i)+")*$)").exec(e),c=a&&a.length>=2?a[1]:"";this.reset();const l=o(c);let d="";for(const y in l)y.toLowerCase()==="fen"&&(d=l[y]),this.header(y,l[y]);if(!n)d&&this.load(d,{preserveHeaders:!0});else if(l.SetUp==="1"){if(!("FEN"in l))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(l.FEN,{preserveHeaders:!0})}function u(y){return Array.from(y).map(function(x){return x.charCodeAt(0)<128?x.charCodeAt(0).toString(16):encodeURIComponent(x).replace(/%/g,"").toLowerCase()}).join("")}function h(y){return y.length==0?"":decodeURIComponent("%"+(y.match(/.{1,2}/g)||[]).join("%"))}const m=function(y){return y=y.replace(new RegExp(r(i),"g")," "),`{${u(y.slice(1,y.length-1))}}`},f=function(y){if(y.startsWith("{")&&y.endsWith("}"))return h(y.slice(1,y.length-1))};let g=e.replace(c,"").replace(new RegExp(`({[^}]*})+?|;([^${r(i)}]*)`,"g"),function(y,x,T){return x!==void 0?m(x):" "+m(`{${T.slice(1)}}`)}).replace(new RegExp(r(i),"g")," ");const _=/(\([^()]+\))+?/g;for(;_.test(g);)g=g.replace(_,"");g=g.replace(/\d+\.(\.\.)?/g,""),g=g.replace(/\.\.\./g,""),g=g.replace(/\$\d+/g,"");let E=g.trim().split(new RegExp(/\s+/));E=E.filter(y=>y!=="");let A="";for(let y=0;y<E.length;y++){const x=f(E[y]);if(x!==void 0){this._comments[this.fen()]=x;continue}const T=this._moveFromSan(E[y],n);if(T==null)if(mo.indexOf(E[y])>-1)A=E[y];else throw new Error(`Invalid move in PGN: ${E[y]}`);else A="",this._makeMove(T),this._incPositionCount(this.fen())}A&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",A)}_moveToSan(e,n){let i="";if(e.flags&w.KSIDE_CASTLE)i="O-O";else if(e.flags&w.QSIDE_CASTLE)i="O-O-O";else{if(e.piece!==D){const r=vo(e,n);i+=e.piece.toUpperCase()+r}e.flags&(w.CAPTURE|w.EP_CAPTURE)&&(e.piece===D&&(i+=L(e.from)[0]),i+="x"),i+=L(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,n=!1){const i=ot(e);let r=Xt(i),o=this._moves({legal:!0,piece:r});for(let h=0,m=o.length;h<m;h++)if(i===ot(this._moveToSan(o[h],o)))return o[h];if(n)return null;let s,a,c,l,d,u=!1;if(a=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(s=a[1],c=a[2],l=a[3],d=a[4],c.length==1&&(u=!0)):(a=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(s=a[1],c=a[2],l=a[3],d=a[4],c.length==1&&(u=!0))),r=Xt(i),o=this._moves({legal:!0,piece:s||r}),!l)return null;for(let h=0,m=o.length;h<m;h++)if(c){if((!s||s.toLowerCase()==o[h].piece)&&v[c]==o[h].from&&v[l]==o[h].to&&(!d||d.toLowerCase()==o[h].promotion))return o[h];if(u){const f=L(o[h].from);if((!s||s.toLowerCase()==o[h].piece)&&v[l]==o[h].to&&(c==f[0]||c==f[1])&&(!d||d.toLowerCase()==o[h].promotion))return o[h]}}else if(i===ot(this._moveToSan(o[h],o)).replace("x",""))return o[h];return null}ascii(){let e=`   +------------------------+
`;for(let n=v.a8;n<=v.h1;n++){if(Te(n)===0&&(e+=" "+"87654321"[fe(n)]+" |"),this._board[n]){const i=this._board[n].type,o=this._board[n].color===R?i.toUpperCase():i.toLowerCase();e+=" "+o+" "}else e+=" . ";n+1&136&&(e+=`|
`,n+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const n=this._moves({legal:!1});let i=0;const r=this._turn;for(let o=0,s=n.length;o<s;o++)this._makeMove(n[o]),this._isKingAttacked(r)||(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}turn(){return this._turn}board(){const e=[];let n=[];for(let i=v.a8;i<=v.h1;i++)this._board[i]==null?n.push(null):n.push({square:L(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(n),n=[],i+=8);return e}squareColor(e){if(e in v){const n=v[e];return(fe(n)+Te(n))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const n=[],i=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const r=n.pop();if(!r)break;e?i.push(new Re(this,r)):i.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return i}_getPositionCount(e){const n=st(e);return this._positionCount[n]||0}_incPositionCount(e){const n=st(e);this._positionCount[n]===void 0&&(this._positionCount[n]=0),this._positionCount[n]+=1}_decPositionCount(e){const n=st(e);this._positionCount[n]===1?delete this._positionCount[n]:this._positionCount[n]-=1}_pruneComments(){const e=[],n={},i=r=>{r in this._comments&&(n[r]=this._comments[r])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){const r=e.pop();if(!r)break;this._makeMove(r),i(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const n=this._comments[e];return delete this._comments[e],{fen:e,comment:n}})}setCastlingRights(e,n){for(const r of[M,ee])n[r]!==void 0&&(n[r]?this._castling[e]|=Le[r]:this._castling[e]&=~Le[r]);this._updateCastlingRights();const i=this.getCastlingRights(e);return(n[M]===void 0||n[M]===i[M])&&(n[ee]===void 0||n[ee]===i[ee])}getCastlingRights(e){return{[M]:(this._castling[e]&Le[M])!==0,[ee]:(this._castling[e]&Le[ee])!==0}}moveNumber(){return this._moveNumber}}class yo{constructor(e="/sf/stockfish-17-lite-02843c1.js"){this.engine=new Worker(e,{type:"module"}),this.isReady=!1,this.currentAnalysis=null,this.pendingResolve=null,this.lastEvaluations={},this.onEvaluationUpdate=null,this.analysisId=0,this._setupEngine(),this._setupListeners()}_setupEngine(){this._sendCommand("uci"),this._sendCommand("setoption name MultiPV value 3"),this._sendCommand("isready")}_setupListeners(){this.engine.onmessage=e=>{const i=e.data.split(`
`);for(const r of i){if(r.includes("readyok")&&(this.isReady=!0),this.currentAnalysis&&r.includes("info depth")&&r.includes("multipv")){const o=/multipv (\d+)/.exec(r),s=/depth (\d+)/.exec(r),a=/ pv (.+)$/.exec(r),c=/score cp ([-\d]+)/.exec(r),l=/score mate ([-\d]+)/.exec(r);if(o&&s&&a&&(c||l)){const d=parseInt(o[1]),u=parseInt(s[1]),h=a[1].split(" ");let m,f=!1;if(c)m=parseInt(c[1]),this.currentAnalysis.sideToMove==="b"&&(m=-m);else if(l){f=!0;const g=parseInt(l[1]);m=g>0?1e4-g*10:-1e4-g*10,this.currentAnalysis.sideToMove==="b"&&(m=-m)}if(this.lastEvaluations[d]={line:d,score:m,depth:u,moves:h,isMate:f,mateIn:f?l[1]:null,centipawnLoss:d===1?0:this.lastEvaluations[1]?Math.abs(this.lastEvaluations[1].score-m):0},this.onEvaluationUpdate){const g=Object.values(this.lastEvaluations);this.onEvaluationUpdate(g,this.currentAnalysis.id)}}}if(this.currentAnalysis&&r.includes("bestmove")){const o=Object.values(this.lastEvaluations);this.currentAnalysis.id,this.pendingResolve&&this.currentAnalysis&&(this.pendingResolve(o),this.pendingResolve=null),this.lastEvaluations={},this.currentAnalysis=null}}}}_sendCommand(e){this.engine.postMessage(e)}async waitForReady(){return this.isReady?Promise.resolve():new Promise(e=>{const n=setInterval(()=>{this.isReady&&(clearInterval(n),e())},100)})}async analyzePosition(e,n=25){await this.waitForReady(),await this._stopAnalysis(),this.lastEvaluations={};const i=++this.analysisId,r=e.split(" ")[1];return this.currentAnalysis={fen:e,depth:n,sideToMove:r,id:i},new Promise(o=>{this.pendingResolve=o,this._sendCommand("position fen "+e),this._sendCommand("go depth "+n)})}async _stopAnalysis(){if(this.currentAnalysis)return new Promise(e=>{this._sendCommand("stop");const n=setInterval(()=>{this.currentAnalysis||(clearInterval(n),e())},50);if(this.pendingResolve){const i=Object.values(this.lastEvaluations);this.pendingResolve(i),this.pendingResolve=null}this.currentAnalysis=null})}dispose(){this._stopAnalysis(),this._sendCommand("quit"),this.engine.terminate()}}const wo=async(t,e,n)=>{const i=new Date,r=[];for(let o=0;o<n;o++){const s=i.getFullYear(),a=String(i.getMonth()+1).padStart(2,"0");r.push(`https://api.chess.com/pub/player/${t}/games/${s}/${a}`),i.setMonth(i.getMonth()-1)}try{const o=[];for(const s of r){const a=await fetch(s);if(!a.ok)continue;const c=await a.json();o.push(...c.games.filter(l=>l.white.username.toLowerCase()===t.toLowerCase()&&e==="white"||l.black.username.toLowerCase()===t.toLowerCase()&&e==="black"))}return o.map(s=>s.pgn)}catch(o){throw console.error("Error fetching Chess.com games:",o),o}},_o=async(t,e,n)=>{const i=new Date;i.setMonth(i.getMonth()-n);const r=`https://lichess.org/api/games/user/${t}?max=500&pgnInJson=true`;try{const o=await fetch(r,{method:"GET",headers:{Accept:"application/x-ndjson"}});if(!o.ok)throw new Error("Failed to fetch data");return(await o.text()).split(`
`).filter(d=>d).map(d=>JSON.parse(d)).filter(d=>new Date(d.createdAt)>=i).filter(d=>e==="white"?d.players.white.user.id===t:e==="black"?d.players.black.user.id===t:!1).map(d=>d.pgn)}catch(o){throw console.error("Error fetching Lichess games:",o),o}},Eo=(t,e,n,i)=>t==="chesscom"?wo(e,n,i):_o(e,n,i);class Io{constructor(e="/sf/stockfish-17-lite-02843c1.js"){this.engine=new Worker(e,{type:"module"}),this.isReady=!1,this.pendingResolve=null,this.currentAnalysis=null,this._setupEngine(),this._setupListeners()}_setupEngine(){this._sendCommand("uci"),this._sendCommand("setoption name MultiPV value 1"),this._sendCommand("isready")}_setupListeners(){this.engine.onmessage=e=>{const i=e.data.split(`
`);for(const r of i){if(r.includes("readyok")&&(this.isReady=!0),this.currentAnalysis&&r.includes("info depth")&&r.includes("score cp")){const o=/score cp ([-\d]+)/.exec(r),s=/depth (\d+)/.exec(r),a=/ pv (.+)$/.exec(r);if(o&&s&&a){let c=parseInt(o[1]);const l=parseInt(s[1]),d=a[1].split(" ");this.currentAnalysis.sideToMove==="b"&&(c=-c),this.currentAnalysis.bestMove={score:c,depth:l,moves:d}}}if(this.currentAnalysis&&r.includes("bestmove")){const o=this.currentAnalysis.bestMove||null;this.pendingResolve&&(this.pendingResolve(o),this.pendingResolve=null),this.currentAnalysis=null}}}}_sendCommand(e){this.engine.postMessage(e)}async waitForReady(){if(!this.isReady)return new Promise(e=>{const n=setInterval(()=>{this.isReady&&(clearInterval(n),e())},100)})}async analyzePosition(e,n=20){return await this.waitForReady(),this.currentAnalysis={fen:e,depth:n,sideToMove:e.split(" ")[1]},new Promise(i=>{this.pendingResolve=i,this._sendCommand(`position fen ${e}`),this._sendCommand(`go depth ${n}`)})}dispose(){this._sendCommand("quit"),this.engine.terminate()}}async function So(t,e=18){const n=new Io;try{return await n.analyzePosition(t,e)}finally{n.dispose()}}class en{constructor(e,n,i){this.fen=e,this.evaluated=!1,this.count=n||0,this.parent=i||null,this.children=[],this.eval=0,this.move=null,this.whiteWins=0,this.blackWins=0,this.draws=0}}class Co{constructor(e,n){this.pgns=e,this.color=n,this.fenNode=new Map,this.chess=new Ce,this.root=new en("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",0),this.fenNode.set(this.root.fen,this.root),this.initialized=!1,this.evaluating=!1,this.initialize().then(()=>{this._startBackgroundEvaluation()})}async initialize(){return this.pgns=await Promise.resolve(this.pgns),await this._parsePGNs(),this.initialized=!0,this}async _parsePGNs(){const e=Array.isArray(this.pgns)?this.pgns:[];for(let n=0;n<e.length;n++)this._putPGN(e[n])}_putPGN(e,n){try{this.chess.loadPgn(e);const i=this.chess.history({verbose:!0}),r=n||this._extractResultFromPgn(e);this.chess.reset();let o=this.chess.fen();this.fenNode.has(o)||this.fenNode.set(o,this.root),this.fenNode.get(o).count++,this._updateResultCounts(this.root,r);let s=this.root;for(const a of i){this.chess.move(a),o=this.chess.fen();let c;this.fenNode.has(o)?(c=this.fenNode.get(o),c.count++):(c=new en(o,1,s),c.move={from:a.from,to:a.to,promotion:a.promotion||null},this.fenNode.set(o,c)),this._updateResultCounts(c,r),s.children.some(l=>l.fen===o)||s.children.push(c),s=c}return this.chess.reset(),!0}catch(i){return console.error("Error processing PGN:",i),!1}}_getUciMoveFromFens(e,n){const i=new Ce(e),r=i.moves({verbose:!0});for(const o of r){if(i.move(o),i.fen()===n)return o;i.undo()}return null}getMovesForPosition(e){if(!this.initialized)return[];const n=this._normalizeFen(e);if(!this.fenNode.has(n))return[];const i=this.fenNode.get(n);return i.children.map(r=>{const o=this._getUciMoveFromFens(e,r.fen),s=new Ce(n),a=s.move(o);let c=!1;return i.evaluated&&r.evaluated&&Math.abs(r.score)-Math.abs(i.score)>.6&&(this.color==="white"&&r.score<i.score&&s.turn()==="b"||this.color==="black"&&r.score>i.score&&s.turn()==="w")&&(c=!0),{san:o.san,uci:`${o.from}${o.to}${o.promotion||""}`,count:r.count,fen:r.fen,evaluation:r.eval,winPercentage:this._calculateWinPercentage(r),whiteWins:r.whiteWins,blackWins:r.blackWins,draws:r.draws,isLegal:!!a,moveSuperScript:c?"??":""}}).filter(r=>r.isLegal).sort((r,o)=>o.count-r.count)}async evalTree(e=this.root.fen){this.initialized||await this.initialize();const n=this._normalizeFen(e);if(!this.fenNode.has(n))return[];this.chess=new Ce(n);const i=this.fenNode.get(n),r=[i];for(;r.length>0;){const o=r.shift();if(!o.evaluated)try{if(o.evaluated===!1){const s=await So(o.fen);o.eval=s.score/100,o.evaluated=!0,document.dispatchEvent(new CustomEvent("explorer-node-evaluated",{detail:{fen:o.fen}}))}for(let s of o.children)r.push(s)}catch(s){console.error("Error during tree evaluation:",s)}}return i}_extractResultFromPgn(e){return e.includes("1-0")?"1-0":e.includes("0-1")?"0-1":e.includes("1/2-1/2")?"1/2-1/2":null}_updateResultCounts(e,n){n==="1-0"?e.whiteWins++:n==="0-1"?e.blackWins++:n==="1/2-1/2"&&e.draws++}_calculateWinPercentage(e){return e.count===0?0:(this.color==="white"?e.whiteWins:e.blackWins)/e.count*100}_startBackgroundEvaluation(){this.evaluating||(this.evaluating=!0,setTimeout(async()=>{await this.evalTree(),this.evaluating=!1},0))}_normalizeFen(e){return e.trim()}}class ko{constructor(e,n,i,r,o){this.username=e,this.platform=n,this.color=i,this.startingPosition=r,this.currentPosition=r,this.months=o,this.container=document.getElementById("explorer-move-list"),this.tree=null,this.pgns=null,this.isInitialized=!1,this.isLoading=!1,this.children=[],document.addEventListener("explorer-node-evaluated",s=>{this.children.some(a=>a.fen===s.detail.fen)&&this.render()})}async initialize(){if(this.isInitialized)return this;this.isLoading=!0;try{return this.pgns=await this._fetchGames(),this.tree=new Co(this.pgns,this.color),await this.tree.initialize(),this.isInitialized=!0,this.isLoading=!1,this}catch(e){throw this.isLoading=!1,console.error("Explorer initialization failed:",e),e}}async _fetchGames(){try{return await Eo(this.platform,this.username,this.color,this.months)}catch(e){throw console.error("Failed to fetch games:",e),e}}async _evalTree(){if(!this.tree)throw new Error("Tree not initialized");await this.tree.evalTree(this.startingPosition)}getMovesForPosition(e=null){if(!this.isInitialized||!this.tree)return[];const n=e||this.currentPosition;return this.tree.getMovesForPosition(n)}updatePosition(e){return this.currentPosition=e,this._startBackgroundEval(),this.getMovesForPosition()}async _startBackgroundEval(){if(this.tree.fenNode.has(this.currentPosition)&&!this.tree.fenNode.get(this.currentPosition).evaluated){this.tree.evaluating=!0;try{await this.tree.evalTree(this.currentPosition)}catch(e){console.error("Background eval failed:",e)}finally{this.tree.evaluating=!1}}}async refresh(e,n,i,r){return e&&(this.username=e),n&&(this.platform=n),i&&(this.color=i),r&&(this.days=r),this.isInitialized=!1,await this.initialize()}render(){if(!this.container)return;if(this.container.innerHTML="",this.isLoading){this.container.innerHTML='<div class="loading">Loading explorer data...</div>';return}if(!this.isInitialized){this.container.innerHTML='<div class="not-initialized">Explorer not initialized</div>';return}const e=this.getMovesForPosition(this.currentPosition);if(this.children=e,e.length===0){this.container.innerHTML='<div class="no-moves">No games found for this position</div>';return}e.forEach((n,i)=>{const r=document.createElement("li");r.className=`explorer-move-${i%2}`,r.innerHTML=`
        <div style="width: 70px;">${n.san+n.moveSuperScript}</div>
        <div style="width: 50px;">${n.count}</div>
        <div style="width: 50px;">${Math.round(n.winPercentage)}%</div>
        <div style="width: 50px;">${(n.evaluation>=0?"+":"-")+Math.abs(n.evaluation).toFixed(2)}</div>
      `,r.addEventListener("click",()=>{const o=new CustomEvent("explorer-san-move-selected",{detail:{san:n.san,fen:n.fen}});document.dispatchEvent(o)}),this.container.appendChild(r)})}}const Ao=()=>{};var tn={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xn=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):(r&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},To=function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const o=t[n++];e[i++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){const o=t[n++],s=t[n++],a=t[n++],c=((r&7)<<18|(o&63)<<12|(s&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{const o=t[n++],s=t[n++];e[i++]=String.fromCharCode((r&15)<<12|(o&63)<<6|s&63)}}return e.join("")},ei={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<t.length;r+=3){const o=t[r],s=r+1<t.length,a=s?t[r+1]:0,c=r+2<t.length,l=c?t[r+2]:0,d=o>>2,u=(o&3)<<4|a>>4;let h=(a&15)<<2|l>>6,m=l&63;c||(m=64,s||(h=64)),i.push(n[d],n[u],n[h],n[m])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Xn(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):To(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<t.length;){const o=n[t.charAt(r++)],a=r<t.length?n[t.charAt(r)]:0;++r;const l=r<t.length?n[t.charAt(r)]:64;++r;const u=r<t.length?n[t.charAt(r)]:64;if(++r,o==null||a==null||l==null||u==null)throw new Mo;const h=o<<2|a>>4;if(i.push(h),l!==64){const m=a<<4&240|l>>2;if(i.push(m),u!==64){const f=l<<6&192|u;i.push(f)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Mo extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Po=function(t){const e=Xn(t);return ei.encodeByteArray(e,!0)},ti=function(t){return Po(t).replace(/\./g,"")},Do=function(t){try{return ei.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xo(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ro=()=>xo().__FIREBASE_DEFAULTS__,Lo=()=>{if(typeof process>"u"||typeof tn>"u")return;const t=tn.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},No=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Do(t[1]);return e&&JSON.parse(e)},Oo=()=>{try{return Ao()||Ro()||Lo()||No()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},ni=()=>{var t;return(t=Oo())===null||t===void 0?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}}function $o(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function ii(){try{return typeof indexedDB=="object"}catch{return!1}}function ri(){return new Promise((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var o;e(((o=r.error)===null||o===void 0?void 0:o.message)||"")}}catch(n){e(n)}})}function Fo(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ho="FirebaseError";class we extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=Ho,Object.setPrototypeOf(this,we.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ve.prototype.create)}}class Ve{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){const i=n[0]||{},r=`${this.service}/${e}`,o=this.errors[e],s=o?qo(o,i):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new we(r,a,i)}}function qo(t,e){return t.replace(zo,(n,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const zo=/\{\$([^}]+)}/g;function je(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const o=t[r],s=e[r];if(nn(o)&&nn(s)){if(!je(o,s))return!1}else if(o!==s)return!1}for(const r of i)if(!n.includes(r))return!1;return!0}function nn(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jo=1e3,Ko=2,Uo=4*60*60*1e3,Wo=.5;function rn(t,e=jo,n=Ko){const i=e*Math.pow(n,t),r=Math.round(Wo*i*(Math.random()-.5)*2);return Math.min(Uo,i+r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oi(t){return t&&t._delegate?t._delegate:t}class re{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ue="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const i=new Bo;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(o){if(r)return null;throw o}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Qo(e))try{this.getOrInitializeService({instanceIdentifier:ue})}catch{}for(const[n,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:r});i.resolve(o)}catch{}}}}clearInstance(e=ue){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ue){return this.instances.has(e)}getOptions(e=ue){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:n});for(const[o,s]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(o);i===a&&s.resolve(r)}return r}onInit(e,n){var i;const r=this.normalizeInstanceIdentifier(n),o=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;o.add(e),this.onInitCallbacks.set(r,o);const s=this.instances.get(r);return s&&e(s,r),()=>{o.delete(e)}}invokeOnInitCallbacks(e,n){const i=this.onInitCallbacks.get(n);if(i)for(const r of i)try{r(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Go(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=ue){return this.component?this.component.multipleInstances?e:ue:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Go(t){return t===ue?void 0:t}function Qo(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Vo(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var S;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(S||(S={}));const Zo={debug:S.DEBUG,verbose:S.VERBOSE,info:S.INFO,warn:S.WARN,error:S.ERROR,silent:S.SILENT},Jo=S.INFO,Xo={[S.DEBUG]:"log",[S.VERBOSE]:"log",[S.INFO]:"info",[S.WARN]:"warn",[S.ERROR]:"error"},es=(t,e,...n)=>{if(e<t.logLevel)return;const i=new Date().toISOString(),r=Xo[e];if(r)console[r](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class si{constructor(e){this.name=e,this._logLevel=Jo,this._logHandler=es,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in S))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Zo[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,S.DEBUG,...e),this._logHandler(this,S.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,S.VERBOSE,...e),this._logHandler(this,S.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,S.INFO,...e),this._logHandler(this,S.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,S.WARN,...e),this._logHandler(this,S.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,S.ERROR,...e),this._logHandler(this,S.ERROR,...e)}}const ts=(t,e)=>e.some(n=>t instanceof n);let on,sn;function ns(){return on||(on=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function is(){return sn||(sn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ai=new WeakMap,yt=new WeakMap,ci=new WeakMap,at=new WeakMap,Ot=new WeakMap;function rs(t){const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("success",o),t.removeEventListener("error",s)},o=()=>{n(te(t.result)),r()},s=()=>{i(t.error),r()};t.addEventListener("success",o),t.addEventListener("error",s)});return e.then(n=>{n instanceof IDBCursor&&ai.set(n,t)}).catch(()=>{}),Ot.set(e,t),e}function os(t){if(yt.has(t))return;const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",s),t.removeEventListener("abort",s)},o=()=>{n(),r()},s=()=>{i(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",o),t.addEventListener("error",s),t.addEventListener("abort",s)});yt.set(t,e)}let wt={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return yt.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ci.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return te(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function ss(t){wt=t(wt)}function as(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const i=t.call(ct(this),e,...n);return ci.set(i,e.sort?e.sort():[e]),te(i)}:is().includes(t)?function(...e){return t.apply(ct(this),e),te(ai.get(this))}:function(...e){return te(t.apply(ct(this),e))}}function cs(t){return typeof t=="function"?as(t):(t instanceof IDBTransaction&&os(t),ts(t,ns())?new Proxy(t,wt):t)}function te(t){if(t instanceof IDBRequest)return rs(t);if(at.has(t))return at.get(t);const e=cs(t);return e!==t&&(at.set(t,e),Ot.set(e,t)),e}const ct=t=>Ot.get(t);function li(t,e,{blocked:n,upgrade:i,blocking:r,terminated:o}={}){const s=indexedDB.open(t,e),a=te(s);return i&&s.addEventListener("upgradeneeded",c=>{i(te(s.result),c.oldVersion,c.newVersion,te(s.transaction),c)}),n&&s.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{o&&c.addEventListener("close",()=>o()),r&&c.addEventListener("versionchange",l=>r(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const ls=["get","getKey","getAll","getAllKeys","count"],ds=["put","add","delete","clear"],lt=new Map;function an(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(lt.get(e))return lt.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=ds.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||ls.includes(n)))return;const o=async function(s,...a){const c=this.transaction(s,r?"readwrite":"readonly");let l=c.store;return i&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),r&&c.done]))[0]};return lt.set(e,o),o}ss(t=>({...t,get:(e,n,i)=>an(e,n)||t.get(e,n,i),has:(e,n)=>!!an(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(hs(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function hs(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const _t="@firebase/app",cn="0.11.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q=new si("@firebase/app"),fs="@firebase/app-compat",ps="@firebase/analytics-compat",gs="@firebase/analytics",ms="@firebase/app-check-compat",bs="@firebase/app-check",vs="@firebase/auth",ys="@firebase/auth-compat",ws="@firebase/database",_s="@firebase/data-connect",Es="@firebase/database-compat",Is="@firebase/functions",Ss="@firebase/functions-compat",Cs="@firebase/installations",ks="@firebase/installations-compat",As="@firebase/messaging",Ts="@firebase/messaging-compat",Ms="@firebase/performance",Ps="@firebase/performance-compat",Ds="@firebase/remote-config",xs="@firebase/remote-config-compat",Rs="@firebase/storage",Ls="@firebase/storage-compat",Ns="@firebase/firestore",Os="@firebase/vertexai",Bs="@firebase/firestore-compat",$s="firebase";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Et="[DEFAULT]",Fs={[_t]:"fire-core",[fs]:"fire-core-compat",[gs]:"fire-analytics",[ps]:"fire-analytics-compat",[bs]:"fire-app-check",[ms]:"fire-app-check-compat",[vs]:"fire-auth",[ys]:"fire-auth-compat",[ws]:"fire-rtdb",[_s]:"fire-data-connect",[Es]:"fire-rtdb-compat",[Is]:"fire-fn",[Ss]:"fire-fn-compat",[Cs]:"fire-iid",[ks]:"fire-iid-compat",[As]:"fire-fcm",[Ts]:"fire-fcm-compat",[Ms]:"fire-perf",[Ps]:"fire-perf-compat",[Ds]:"fire-rc",[xs]:"fire-rc-compat",[Rs]:"fire-gcs",[Ls]:"fire-gcs-compat",[Ns]:"fire-fst",[Bs]:"fire-fst-compat",[Os]:"fire-vertex","fire-js":"fire-js",[$s]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ke=new Map,Hs=new Map,It=new Map;function ln(t,e){try{t.container.addComponent(e)}catch(n){Q.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ge(t){const e=t.name;if(It.has(e))return Q.debug(`There were multiple attempts to register component ${e}.`),!1;It.set(e,t);for(const n of Ke.values())ln(n,t);for(const n of Hs.values())ln(n,t);return!0}function Ge(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qs={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ne=new Ve("app","Firebase",qs);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e,n,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new re("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ne.create("app-deleted",{appName:this._name})}}function di(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const i=Object.assign({name:Et,automaticDataCollectionEnabled:!1},e),r=i.name;if(typeof r!="string"||!r)throw ne.create("bad-app-name",{appName:String(r)});if(n||(n=ni()),!n)throw ne.create("no-options");const o=Ke.get(r);if(o){if(je(n,o.options)&&je(i,o.config))return o;throw ne.create("duplicate-app",{appName:r})}const s=new Yo(r);for(const c of It.values())s.addComponent(c);const a=new zs(n,i,s);return Ke.set(r,a),a}function js(t=Et){const e=Ke.get(t);if(!e&&t===Et&&ni())return di();if(!e)throw ne.create("no-app",{appName:t});return e}function ie(t,e,n){var i;let r=(i=Fs[t])!==null&&i!==void 0?i:t;n&&(r+=`-${n}`);const o=r.match(/\s|\//),s=e.match(/\s|\//);if(o||s){const a=[`Unable to register library "${r}" with version "${e}":`];o&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),o&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Q.warn(a.join(" "));return}ge(new re(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ks="firebase-heartbeat-database",Us=1,Me="firebase-heartbeat-store";let dt=null;function ui(){return dt||(dt=li(Ks,Us,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Me)}catch(n){console.warn(n)}}}}).catch(t=>{throw ne.create("idb-open",{originalErrorMessage:t.message})})),dt}async function Ws(t){try{const n=(await ui()).transaction(Me),i=await n.objectStore(Me).get(hi(t));return await n.done,i}catch(e){if(e instanceof we)Q.warn(e.message);else{const n=ne.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Q.warn(n.message)}}}async function dn(t,e){try{const i=(await ui()).transaction(Me,"readwrite");await i.objectStore(Me).put(e,hi(t)),await i.done}catch(n){if(n instanceof we)Q.warn(n.message);else{const i=ne.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Q.warn(i.message)}}}function hi(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vs=1024,Gs=30;class Qs{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Zs(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,n;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=un();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(s=>s.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:r}),this._heartbeatsCache.heartbeats.length>Gs){const s=Js(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){Q.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=un(),{heartbeatsToSend:i,unsentEntries:r}=Ys(this._heartbeatsCache.heartbeats),o=ti(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=n,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(n){return Q.warn(n),""}}}function un(){return new Date().toISOString().substring(0,10)}function Ys(t,e=Vs){const n=[];let i=t.slice();for(const r of t){const o=n.find(s=>s.agent===r.agent);if(o){if(o.dates.push(r.date),hn(n)>e){o.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),hn(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class Zs{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ii()?ri().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Ws(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return dn(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return dn(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function hn(t){return ti(JSON.stringify({version:2,heartbeats:t})).length}function Js(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xs(t){ge(new re("platform-logger",e=>new us(e),"PRIVATE")),ge(new re("heartbeat",e=>new Qs(e),"PRIVATE")),ie(_t,cn,t),ie(_t,cn,"esm2017"),ie("fire-js","")}Xs("");var ea="firebase",ta="11.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ie(ea,ta,"app");const fi="@firebase/installations",Bt="0.6.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pi=1e4,gi=`w:${Bt}`,mi="FIS_v2",na="https://firebaseinstallations.googleapis.com/v1",ia=60*60*1e3,ra="installations",oa="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sa={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},me=new Ve(ra,oa,sa);function bi(t){return t instanceof we&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vi({projectId:t}){return`${na}/projects/${t}/installations`}function yi(t){return{token:t.token,requestStatus:2,expiresIn:ca(t.expiresIn),creationTime:Date.now()}}async function wi(t,e){const i=(await e.json()).error;return me.create("request-failed",{requestName:t,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function _i({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function aa(t,{refreshToken:e}){const n=_i(t);return n.append("Authorization",la(e)),n}async function Ei(t){const e=await t();return e.status>=500&&e.status<600?t():e}function ca(t){return Number(t.replace("s","000"))}function la(t){return`${mi} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function da({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=vi(t),r=_i(t),o=e.getImmediate({optional:!0});if(o){const l=await o.getHeartbeatsHeader();l&&r.append("x-firebase-client",l)}const s={fid:n,authVersion:mi,appId:t.appId,sdkVersion:gi},a={method:"POST",headers:r,body:JSON.stringify(s)},c=await Ei(()=>fetch(i,a));if(c.ok){const l=await c.json();return{fid:l.fid||n,registrationStatus:2,refreshToken:l.refreshToken,authToken:yi(l.authToken)}}else throw await wi("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ua(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ha=/^[cdef][\w-]{21}$/,St="";function fa(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=pa(t);return ha.test(n)?n:St}catch{return St}}function pa(t){return ua(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qe(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Si=new Map;function Ci(t,e){const n=Qe(t);ki(n,e),ga(n,e)}function ki(t,e){const n=Si.get(t);if(n)for(const i of n)i(e)}function ga(t,e){const n=ma();n&&n.postMessage({key:t,fid:e}),ba()}let he=null;function ma(){return!he&&"BroadcastChannel"in self&&(he=new BroadcastChannel("[Firebase] FID Change"),he.onmessage=t=>{ki(t.data.key,t.data.fid)}),he}function ba(){Si.size===0&&he&&(he.close(),he=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const va="firebase-installations-database",ya=1,be="firebase-installations-store";let ut=null;function $t(){return ut||(ut=li(va,ya,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(be)}}})),ut}async function Ue(t,e){const n=Qe(t),r=(await $t()).transaction(be,"readwrite"),o=r.objectStore(be),s=await o.get(n);return await o.put(e,n),await r.done,(!s||s.fid!==e.fid)&&Ci(t,e.fid),e}async function Ai(t){const e=Qe(t),i=(await $t()).transaction(be,"readwrite");await i.objectStore(be).delete(e),await i.done}async function Ye(t,e){const n=Qe(t),r=(await $t()).transaction(be,"readwrite"),o=r.objectStore(be),s=await o.get(n),a=e(s);return a===void 0?await o.delete(n):await o.put(a,n),await r.done,a&&(!s||s.fid!==a.fid)&&Ci(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ft(t){let e;const n=await Ye(t.appConfig,i=>{const r=wa(i),o=_a(t,r);return e=o.registrationPromise,o.installationEntry});return n.fid===St?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function wa(t){const e=t||{fid:fa(),registrationStatus:0};return Ti(e)}function _a(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const r=Promise.reject(me.create("app-offline"));return{installationEntry:e,registrationPromise:r}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=Ea(t,n);return{installationEntry:n,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Ia(t)}:{installationEntry:e}}async function Ea(t,e){try{const n=await da(t,e);return Ue(t.appConfig,n)}catch(n){throw bi(n)&&n.customData.serverCode===409?await Ai(t.appConfig):await Ue(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function Ia(t){let e=await fn(t.appConfig);for(;e.registrationStatus===1;)await Ii(100),e=await fn(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:i}=await Ft(t);return i||n}return e}function fn(t){return Ye(t,e=>{if(!e)throw me.create("installation-not-found");return Ti(e)})}function Ti(t){return Sa(t)?{fid:t.fid,registrationStatus:0}:t}function Sa(t){return t.registrationStatus===1&&t.registrationTime+pi<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ca({appConfig:t,heartbeatServiceProvider:e},n){const i=ka(t,n),r=aa(t,n),o=e.getImmediate({optional:!0});if(o){const l=await o.getHeartbeatsHeader();l&&r.append("x-firebase-client",l)}const s={installation:{sdkVersion:gi,appId:t.appId}},a={method:"POST",headers:r,body:JSON.stringify(s)},c=await Ei(()=>fetch(i,a));if(c.ok){const l=await c.json();return yi(l)}else throw await wi("Generate Auth Token",c)}function ka(t,{fid:e}){return`${vi(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ht(t,e=!1){let n;const i=await Ye(t.appConfig,o=>{if(!Mi(o))throw me.create("not-registered");const s=o.authToken;if(!e&&Ma(s))return o;if(s.requestStatus===1)return n=Aa(t,e),o;{if(!navigator.onLine)throw me.create("app-offline");const a=Da(o);return n=Ta(t,a),a}});return n?await n:i.authToken}async function Aa(t,e){let n=await pn(t.appConfig);for(;n.authToken.requestStatus===1;)await Ii(100),n=await pn(t.appConfig);const i=n.authToken;return i.requestStatus===0?Ht(t,e):i}function pn(t){return Ye(t,e=>{if(!Mi(e))throw me.create("not-registered");const n=e.authToken;return xa(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function Ta(t,e){try{const n=await Ca(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await Ue(t.appConfig,i),n}catch(n){if(bi(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await Ai(t.appConfig);else{const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Ue(t.appConfig,i)}throw n}}function Mi(t){return t!==void 0&&t.registrationStatus===2}function Ma(t){return t.requestStatus===2&&!Pa(t)}function Pa(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+ia}function Da(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function xa(t){return t.requestStatus===1&&t.requestTime+pi<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ra(t){const e=t,{installationEntry:n,registrationPromise:i}=await Ft(e);return i?i.catch(console.error):Ht(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function La(t,e=!1){const n=t;return await Na(n),(await Ht(n,e)).token}async function Na(t){const{registrationPromise:e}=await Ft(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oa(t){if(!t||!t.options)throw ht("App Configuration");if(!t.name)throw ht("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw ht(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function ht(t){return me.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pi="installations",Ba="installations-internal",$a=t=>{const e=t.getProvider("app").getImmediate(),n=Oa(e),i=Ge(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},Fa=t=>{const e=t.getProvider("app").getImmediate(),n=Ge(e,Pi).getImmediate();return{getId:()=>Ra(n),getToken:r=>La(n,r)}};function Ha(){ge(new re(Pi,$a,"PUBLIC")),ge(new re(Ba,Fa,"PRIVATE"))}Ha();ie(fi,Bt);ie(fi,Bt,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const We="analytics",qa="firebase_id",za="origin",ja=60*1e3,Ka="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",qt="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B=new si("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ua={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},H=new Ve("analytics","Analytics",Ua);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(t){if(!t.startsWith(qt)){const e=H.create("invalid-gtag-resource",{gtagURL:t});return B.warn(e.message),""}return t}function Di(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function Va(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function Ga(t,e){const n=Va("firebase-js-sdk-policy",{createScriptURL:Wa}),i=document.createElement("script"),r=`${qt}?l=${t}&id=${e}`;i.src=n?n==null?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}function Qa(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function Ya(t,e,n,i,r,o){const s=i[r];try{if(s)await e[s];else{const c=(await Di(n)).find(l=>l.measurementId===r);c&&await e[c.appId]}}catch(a){B.error(a)}t("config",r,o)}async function Za(t,e,n,i,r){try{let o=[];if(r&&r.send_to){let s=r.send_to;Array.isArray(s)||(s=[s]);const a=await Di(n);for(const c of s){const l=a.find(u=>u.measurementId===c),d=l&&e[l.appId];if(d)o.push(d);else{o=[];break}}}o.length===0&&(o=Object.values(e)),await Promise.all(o),t("event",i,r||{})}catch(o){B.error(o)}}function Ja(t,e,n,i){async function r(o,...s){try{if(o==="event"){const[a,c]=s;await Za(t,e,n,a,c)}else if(o==="config"){const[a,c]=s;await Ya(t,e,n,i,a,c)}else if(o==="consent"){const[a,c]=s;t("consent",a,c)}else if(o==="get"){const[a,c,l]=s;t("get",a,c,l)}else if(o==="set"){const[a]=s;t("set",a)}else t(o,...s)}catch(a){B.error(a)}}return r}function Xa(t,e,n,i,r){let o=function(...s){window[i].push(arguments)};return window[r]&&typeof window[r]=="function"&&(o=window[r]),window[r]=Ja(o,t,e,n),{gtagCore:o,wrappedGtag:window[r]}}function ec(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(qt)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc=30,nc=1e3;class ic{constructor(e={},n=nc){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const xi=new ic;function rc(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function oc(t){var e;const{appId:n,apiKey:i}=t,r={method:"GET",headers:rc(i)},o=Ka.replace("{app-id}",n),s=await fetch(o,r);if(s.status!==200&&s.status!==304){let a="";try{const c=await s.json();!((e=c.error)===null||e===void 0)&&e.message&&(a=c.error.message)}catch{}throw H.create("config-fetch-failed",{httpStatus:s.status,responseMessage:a})}return s.json()}async function sc(t,e=xi,n){const{appId:i,apiKey:r,measurementId:o}=t.options;if(!i)throw H.create("no-app-id");if(!r){if(o)return{measurementId:o,appId:i};throw H.create("no-api-key")}const s=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new lc;return setTimeout(async()=>{a.abort()},ja),Ri({appId:i,apiKey:r,measurementId:o},s,a,e)}async function Ri(t,{throttleEndTimeMillis:e,backoffCount:n},i,r=xi){var o;const{appId:s,measurementId:a}=t;try{await ac(i,e)}catch(c){if(a)return B.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:s,measurementId:a};throw c}try{const c=await oc(t);return r.deleteThrottleMetadata(s),c}catch(c){const l=c;if(!cc(l)){if(r.deleteThrottleMetadata(s),a)return B.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:s,measurementId:a};throw c}const d=Number((o=l==null?void 0:l.customData)===null||o===void 0?void 0:o.httpStatus)===503?rn(n,r.intervalMillis,tc):rn(n,r.intervalMillis),u={throttleEndTimeMillis:Date.now()+d,backoffCount:n+1};return r.setThrottleMetadata(s,u),B.debug(`Calling attemptFetch again in ${d} millis`),Ri(t,u,i,r)}}function ac(t,e){return new Promise((n,i)=>{const r=Math.max(e-Date.now(),0),o=setTimeout(n,r);t.addEventListener(()=>{clearTimeout(o),i(H.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function cc(t){if(!(t instanceof we)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class lc{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function dc(t,e,n,i,r){if(r&&r.global){t("event",n,i);return}else{const o=await e,s=Object.assign(Object.assign({},i),{send_to:o});t("event",n,s)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uc(){if(ii())try{await ri()}catch(t){return B.warn(H.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return B.warn(H.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function hc(t,e,n,i,r,o,s){var a;const c=sc(t);c.then(m=>{n[m.measurementId]=m.appId,t.options.measurementId&&m.measurementId!==t.options.measurementId&&B.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>B.error(m)),e.push(c);const l=uc().then(m=>{if(m)return i.getId()}),[d,u]=await Promise.all([c,l]);ec(o)||Ga(o,d.measurementId),r("js",new Date);const h=(a=s==null?void 0:s.config)!==null&&a!==void 0?a:{};return h[za]="firebase",h.update=!0,u!=null&&(h[qa]=u),r("config",d.measurementId,h),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc{constructor(e){this.app=e}_delete(){return delete ke[this.app.options.appId],Promise.resolve()}}let ke={},gn=[];const mn={};let ft="dataLayer",pc="gtag",bn,Li,vn=!1;function gc(){const t=[];if($o()&&t.push("This is a browser extension environment."),Fo()||t.push("Cookies are not available."),t.length>0){const e=t.map((i,r)=>`(${r+1}) ${i}`).join(" "),n=H.create("invalid-analytics-context",{errorInfo:e});B.warn(n.message)}}function mc(t,e,n){gc();const i=t.options.appId;if(!i)throw H.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)B.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw H.create("no-api-key");if(ke[i]!=null)throw H.create("already-exists",{id:i});if(!vn){Qa(ft);const{wrappedGtag:o,gtagCore:s}=Xa(ke,gn,mn,ft,pc);Li=o,bn=s,vn=!0}return ke[i]=hc(t,gn,mn,e,bn,ft,n),new fc(t)}function bc(t=js()){t=oi(t);const e=Ge(t,We);return e.isInitialized()?e.getImmediate():vc(t)}function vc(t,e={}){const n=Ge(t,We);if(n.isInitialized()){const r=n.getImmediate();if(je(e,n.getOptions()))return r;throw H.create("already-initialized")}return n.initialize({options:e})}function yc(t,e,n,i){t=oi(t),dc(Li,ke[t.app.options.appId],e,n,i).catch(r=>B.error(r))}const yn="@firebase/analytics",wn="0.10.12";function wc(){ge(new re(We,(e,{options:n})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();return mc(i,r,n)},"PUBLIC")),ge(new re("analytics-internal",t,"PRIVATE")),ie(yn,wn),ie(yn,wn,"esm2017");function t(e){try{const n=e.getProvider(We).getImmediate();return{logEvent:(i,r,o)=>yc(n,i,r,o)}}catch(n){throw H.create("interop-component-reg-failed",{reason:n})}}}wc();const _c={apiKey:"AIzaSyAvmcgjTiLkgfZiZo6FXMeH1-OoVMy-xfU",authDomain:"prepout.firebaseapp.com",projectId:"prepout",storageBucket:"prepout.firebasestorage.app",messagingSenderId:"1096566410971",appId:"1:1096566410971:web:d2ab27ef8b8728f4b846fe",measurementId:"G-GBTVZ48VXT"},Ec=di(_c);bc(Ec);const b={username:document.getElementById("username"),websiteOrigin:document.getElementById("websiteOrigin"),colorToggle:document.getElementById("colorToggle"),months:document.getElementById("months"),icon:document.getElementById("queenIcon"),searching:document.getElementById("startSearch"),board:document.getElementById("board"),resizeHandle:document.getElementById("resize-handle"),container:document.getElementById("container"),engineEvaluation:document.getElementById("evaluation-score"),engineDepth:document.getElementById("engine-depth"),lines:[document.getElementById("line1"),document.getElementById("line2"),document.getElementById("line3")],evalScores:[document.getElementById("score1"),document.getElementById("score2"),document.getElementById("score3")],evalLines:[document.getElementById("moves1"),document.getElementById("moves2"),document.getElementById("moves3")],explorerMoveList:document.getElementById("explorer-move-list"),settingsToggle:document.getElementById("settings"),settingsPopup:document.getElementById("settings-popup"),settingsFooter:document.getElementById("settings-footer"),depthSlider:document.getElementById("depth-slider"),depthValue:document.getElementById("size-value"),blueButton:document.getElementById("blue-button"),greenButton:document.getElementById("green-button"),brownButton:document.getElementById("brown-button")},p={userIsWhite:!0,engine:new yo,chess:new Ce,ground:null,explorer:null,moveHistory:[],currentMoveIndex:0,currentAnalysisId:0,maxDepth:30,lines:[],boardTheme:"brown"};async function Ni(t,e,n,i){try{b.explorerMoveList&&(b.explorerMoveList.innerHTML='<div class="loading">Loading explorer data...</div>');const r=p.chess.fen();p.explorer=new ko(t,e,n,r,i),await p.explorer.initialize(),p.explorer.render()}catch(r){console.error("Failed to initialize explorer:",r),b.explorerMoveList&&(b.explorerMoveList.innerHTML='<div class="error">Error loading explorer data</div>')}}function Oi(){p.explorer&&(p.explorer.updatePosition(p.chess.fen()),p.explorer.render())}p.engine.onEvaluationUpdate=(t,e)=>{if(e!==p.currentAnalysisId)return;let n=null,i=null,r=null;p.lines=t.map(o=>o.moves[0]),t.forEach(o=>{const s=o.line-1;if(s>=0&&s<3){const a=(o.score/100).toFixed(2),c=o.score>=0?"+":"";b.evalScores[s].innerText=`${c}${a}`,o.score>=0?b.evalScores[s].className="white-advantage":b.evalScores[s].className="black-advantage",n===null&&(r=c,n=a,i=o.depth);let l=o.moves.slice(0,10).join(" ");o.line>1&&o.centipawnLoss>0&&(l+=` (${o.centipawnLoss}cp)`),b.evalLines[s].innerText=l}}),b.engineEvaluation.innerText=`${r}${n}`,b.engineDepth.innerText=`(d=${i}/${p.maxDepth})`};function _n(){const t=window.innerWidth,e=window.innerHeight,n=Math.min(t*.7,e*.7);b.board.style.width=`${n}px`,b.board.style.height=`${n}px`,p.ground&&p.ground.redrawAll()}function Ze(t){p.currentMoveIndex<p.moveHistory.length-1&&p.moveHistory.splice(p.currentMoveIndex+1),p.moveHistory.push({move:t,fen:p.chess.fen()}),p.currentMoveIndex=p.moveHistory.length-1}function Ic(t,e,n=void 0){const i=p.chess.move({from:t,to:e,promotion:n});return i?(Ze(i),De(),i):null}function Bi(t){const e=p.chess.move(t);return e?(Ze(e),De(),e):null}function Ct(t){const e=p.chess.move(t);return e?(Ze(e),De(),e):null}function kt(t){if(t==="prev"&&p.currentMoveIndex>0)p.currentMoveIndex--;else if(t==="next"&&p.currentMoveIndex<p.moveHistory.length-1)p.currentMoveIndex++;else return;p.chess.load(p.moveHistory[p.currentMoveIndex].fen),Je(p.chess.fen(),p.maxDepth),Oi();const e=p.moveHistory[p.currentMoveIndex].move,n=e?[e.from,e.to]:void 0;p.ground.set({fen:p.chess.fen(),turnColor:p.chess.turn()==="w"?"white":"black",movable:{color:p.chess.turn()==="w"?"white":"black",dests:$i(),free:!1},lastMove:n})}function $i(){const t=new Map,e=p.chess;for(let n=0;n<8;n++)for(let i=0;i<8;i++){const r=String.fromCharCode(97+i),o=8-n,s=r+o;if(e.get(s)){const c=e.moves({square:s,verbose:!0});c.length>0&&t.set(s,c.map(l=>l.to))}}return t}function Sc(){for(let t=0;t<3;t++)b.evalScores[t].innerText="...",b.evalLines[t].innerText="..."}async function Je(t,e=p.maxDepth){Sc(),p.currentAnalysisId=p.engine.analysisId+1;try{await p.engine.analyzePosition(t,e)}catch(n){console.log("Engine analysis error:",n)}}function De(){const t=$i();Je(p.chess.fen(),p.maxDepth),Oi(),p.ground.set({fen:p.chess.fen(),turnColor:p.chess.turn()==="w"?"white":"black",movable:{color:p.chess.turn()==="w"?"white":"black",dests:t,free:!1,events:{after:(e,n,i)=>{const r=p.chess.move({from:e,to:n,promotion:i==null?void 0:i.promotion});Ze(r),De()}}}})}function Cc(){b.settingsFooter.style.display==="flex"?b.settingsFooter.style.display="none":b.settingsFooter.style.display="flex"}function Oe(t){const e=document.querySelector("cg-board");if(e){switch(e.style.backgroundImage="none",t){case"blue":e.style.backgroundImage="url('/images/blue.svg')";break;case"green":e.style.backgroundImage="url('/images/green.png')";break;case"brown":e.style.backgroundImage="url('/images/brown.png')";break;default:e.style.backgroundImage="url('/images/brown.png')"}b.blueButton.style.border=t==="blue"?"2px solid white":"2px solid transparent",b.greenButton.style.border=t==="green"?"2px solid white":"2px solid transparent",b.brownButton.style.border=t==="brown"?"2px solid white":"2px solid transparent",p.boardTheme=t}}async function kc(){p.moveHistory=[{fen:p.chess.fen(),move:null}],p.currentMoveIndex=0;const t={coordinates:!1,viewOnly:!1};p.ground=ro(b.board,t),await p.engine.waitForReady(),window.addEventListener("resize",_n),b.settingsToggle.addEventListener("click",Cc),document.addEventListener("click",e=>{!b.settingsPopup.contains(e.target)&&e.target!==b.settingsToggle&&(b.settingsFooter.style.display="none")}),b.colorToggle.addEventListener("click",()=>{p.userIsWhite=!p.userIsWhite,p.ground.toggleOrientation(),b.icon.innerHTML=p.userIsWhite?'<path fill="white" stroke="black" stroke-width="2" d="M12 2L15 8H9L12 2ZM6 8L9 22H15L18 8H6ZM3 22H21V24H3V22Z"/>':'<path fill="black" stroke="black" stroke-width="2" d="M12 2L15 8H9L12 2ZM6 8L9 22H15L18 8H6ZM3 22H21V24H3V22Z"/>'}),document.addEventListener("keydown",e=>{e.key==="ArrowLeft"?(kt("prev"),e.preventDefault()):e.key==="ArrowRight"&&(kt("next"),e.preventDefault())}),b.searching.addEventListener("click",async()=>{try{Ni(b.username.value,b.websiteOrigin.value,p.userIsWhite?"white":"black",parseInt(b.months.value))}catch(e){console.error("Error fetching games:",e)}});for(let e=0;e<3;e++)b.lines[e].addEventListener("mouseenter",()=>{p.ground.set({drawable:{shapes:[{orig:p.lines[e].substring(0,2),dest:p.lines[e].substring(2,4),brush:"green"}]}})}),b.lines[e].addEventListener("mouseleave",()=>{p.ground.set({drawable:{shapes:[]}})}),b.lines[e].addEventListener("click",()=>{Ct(p.lines[e])});b.resizeHandle.addEventListener("mousedown",e=>{e.preventDefault();const n=200,i=Math.min(window.innerWidth*.7,window.innerHeight*.7);function r(s){let a=Math.min(s.clientX-b.container.offsetLeft,s.clientY-b.container.offsetTop);a=Math.max(n,a),a=Math.min(i,a),b.board.style.width=`${a}px`,b.board.style.height=`${a}px`,p.ground&&p.ground.redrawAll()}function o(){document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o)}document.addEventListener("mousemove",r),document.addEventListener("mouseup",o)}),document.addEventListener("explorer-san-move-selected",e=>{const{san:n}=e.detail;Bi(n)}),document.addEventListener("explorer-uci-move-selected",e=>{const{uci:n}=e.detail;Ct(n)}),b.depthSlider.addEventListener("input",()=>{const e=parseInt(b.depthSlider.value,10);p.maxDepth=e,b.depthValue.textContent=e,Je(p.chess.fen(),p.maxDepth)}),b.blueButton.addEventListener("click",()=>Oe("blue")),b.greenButton.addEventListener("click",()=>Oe("green")),b.brownButton.addEventListener("click",()=>Oe("brown")),_n(),De()}window.addEventListener("beforeunload",()=>{p.engine.dispose()});kc();window.chessFunctions={makeMove:Ic,makeSanMove:Bi,makeUCIMove:Ct,navigateMove:kt,initializeExplorer:Ni,updateBoardTheme:Oe,setEngineDepth:t=>{p.maxDepth=t,b.depthSlider.value=t,b.depthValue.textContent=t,Je(p.chess.fen(),t)}};
